<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>Page 2 | xco1a&#39;s b10g</title>
  <meta name="author" content="xcola">

  
  <meta name="description" content="做有态度的码农">
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  
  <meta property="og:site_name" content="xco1a&#39;s b10g">

  
  

  
    <meta property="og:image" content="">
  

  
  <link href="/css/images/favicon.ico" rel="icon">
  

  <link rel="alternate" href="/atom.xml" title="xco1a&#39;s b10g" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src="//push.zhanzhang.baidu.com/push.js"></script>

</head>
</html>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">xco1a&#39;s b10g</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper">
  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-06-16T04:31:09.000Z"><a href="/2018/06/16/express-mongodb搭建简易博客系统/">2018-06-16</a></time>
      
      
  
    <h1 class="title"><a href="/2018/06/16/express-mongodb搭建简易博客系统/">express+mongodb搭建简易博客系统</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="准备事项"><a href="#准备事项" class="headerlink" title="准备事项"></a>准备事项</h2><p>安装Nodejs，express，git，mongodb以及各种依赖库的过程略去不提。使用eslint规范代码。</p>
<p><code>npm install -g eslint</code></p>
<p>也可以 <em>–save-dev</em> 选择本地依赖安装 。懒人必备，直接init一个eslint规则。</p>
<p><code>eslint --init</code></p>
<p>这会提供几个可选选项，根据你的选择创建规范规则文件。放张图。</p>
<p><img src="\uploads\20180616124006.png" alt="20180616124006"></p>
<p>express通过mongoose库配置mongodb连接。app.js文件添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose =<span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line">mongoose.connect(<span class="string">"mongodb://127.0.0.1:27017/express_blog"</span>);</span><br></pre></td></tr></table></figure>
<p>package.json修改script项实现自动重启服务，此处需要node-dev包。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"scripts"</span>: &#123;</span><br><span class="line">    <span class="string">"start"</span>: <span class="string">"node-dev ./bin/www"</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>新建git仓库。</p>
<p><code>git init</code></p>
<p>新建 .gitignore 文件忽略node_modules文件夹。之后add文件，add . 匹配所有文件。</p>
<p><code>git add .</code></p>
<p>commit提交初始的环境配置。</p>
<p><code>git commit -m &quot;init&quot;</code></p>
<p>github上create a new repository后关联到远程仓库</p>
<p><code>git remote add origin git remote add origin https://github.com/flycatrix/express-blog.git</code></p>
<p>将本地仓库的内容推到远程库上</p>
<p><code>git push -u origin master</code></p>
<p>本地和远程分支合并</p>
<p><code>git pull origin master:master</code></p>
<p>准备OK。</p>
<h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="mongoose（猫鼬）中间件"><a href="#mongoose（猫鼬）中间件" class="headerlink" title="mongoose（猫鼬）中间件"></a>mongoose（猫鼬）中间件</h3><p>博客的功能很大程度上依赖数据库操作，使用mongoose库（猫鼬）简化mongodb操作。mongoose使用对象模型的方法对mongodb数据库进行操作，使用schema方法规范模型的变量个数，变量类型等。吐槽官方文档，一个技术文档写的那么萌。。</p>
<p>model文件夹存放要使用到的数据模型。简单的user模型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mongoose =<span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">var</span> Schema= mongoose.Schema;</span><br><span class="line"><span class="keyword">var</span>  obj = &#123;</span><br><span class="line">	username:<span class="built_in">String</span>,</span><br><span class="line">	password:<span class="built_in">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> model = mongoose.model(<span class="string">"user"</span> ,<span class="keyword">new</span> Schema(obj));</span><br><span class="line"><span class="built_in">module</span>.exports = model;</span><br></pre></td></tr></table></figure>
<p>建立模型需要引用mongoose模块，Schema构造函数将写好的数据模型obj包装成Schema对象，最终导出的model对象将继承Schema构造函数的原型中所定义的 访问和操作mongodb 的方法。</p>
<p>schema有十种数据类型，string是其中之一，MongoDB期望用户能按固定的规律存放数据，但实际上用户可以在MongoDB中的任一集合内存放任一类型的数据。mongoose采取事先说明好数据结构和类型的方式，规范用户写入MongoDB中的数据。同时，Schema也能在定义模型时定义MongoDB的索引，支持指定索引（index）或者唯一索引（unique）。对mongoose模型的使用将分散在各路由页面说明。</p>
<p>关于Schema的更多用法和解释可移步mongoose的文档，写文档的一定是个爱猫的程序员。</p>
<h2 id="session-cookie用户验证"><a href="#session-cookie用户验证" class="headerlink" title="session - cookie用户验证"></a>session - cookie用户验证</h2><h3 id="关于session"><a href="#关于session" class="headerlink" title="关于session"></a>关于session</h3><p>用户的的登录状态和权限等级的确认均需要用到cookie机制，然而用户在浏览器端可以轻易更改、伪造cookie。就如xss攻击可以在用户不知情的情况下获取记录在用户浏览器中的无httponly属性的cookie信息，攻击者一旦成功伪造cookie登入，便可操作受害人的资料数据等。然而xss有绕过httponly的方法，且httponly对中间人攻击无效。一年以前曾经测试过中间人攻击，直接登入受害人QQ邮箱。。不过cookie的secure属性可以只在https通信中传递cookie，可以有效防范中间人，嗅探什么的。。emm废话不说了。</p>
<p>此外，cookie在每次请求的时候都会被附加在请求头中，大量的cookie必然会影响传输效率。那么，session应运而生。</p>
<p>session是存储在服务器中的数据，通过session_id运作。当收到请求时，取出保存在cookie中的session，在服务端查看其是否存在登录属性，借此判断用户的登录状态。</p>
<h3 id="express-session中间件"><a href="#express-session中间件" class="headerlink" title="express-session中间件"></a>express-session中间件</h3><p>express-session中间件件实现会话。先npm install express-session –save-dev，然后app.js中添加</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> session = <span class="built_in">require</span>(<span class="string">"express-session"</span>);</span><br><span class="line">app.use(session(&#123;</span><br><span class="line">    name: <span class="string">"sessionid"</span>, <span class="comment">// 在响应中cookie的name字段，默认是connect.sid</span></span><br><span class="line">    secret:<span class="string">"xcola"</span>, <span class="comment">//用secret签名保证是本服务器生成的session</span></span><br><span class="line">    cookie: &#123;<span class="attr">maxAge</span>: <span class="number">1000</span>*<span class="number">3600</span> &#125;, <span class="comment">//1小时</span></span><br><span class="line">    resave: <span class="literal">true</span>,<span class="comment">// 将session强制保存在store中</span></span><br><span class="line">    saveUninitialized: <span class="literal">true</span> <span class="comment">// 第一次访问即设置cookie</span></span><br><span class="line">&#125;));</span><br></pre></td></tr></table></figure>
<p>当用户首次访问页面时，就为用户分配一个cookie，其中保存对应的sessionid。</p>
<p><strong>登录逻辑：</strong>若用户登录成功，那么为这个session新添一个属性，当下次请求来临时，取得用户session中新增的属性字段，若为空则是未登录用户，若不为空则是已登录用户。</p>
<p><strong>注销逻辑：</strong>使用destroy方法摧毁当前会话，在摧毁后会重新生成一个新的没有登录状态的session会话。</p>
<h2 id="登录与注册功能"><a href="#登录与注册功能" class="headerlink" title="登录与注册功能"></a>登录与注册功能</h2><p>在express添加新路由需要三步。</p>
<ul>
<li>app.js 中require 路由模块（存放在routes文件夹下）</li>
<li>app.js 中use注册路由</li>
<li>routes文件夹中添加新路由模块文件并设置路由规则</li>
</ul>
<h3 id="register-注册页"><a href="#register-注册页" class="headerlink" title="register - 注册页"></a>register - 注册页</h3><h4 id="register-ejs模版部分"><a href="#register-ejs模版部分" class="headerlink" title="register.ejs模版部分"></a>register.ejs模版部分</h4><p>views文件夹新建register.ejs模版。页面部件偷懒扒取自bootstrap。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&apos;stylesheet&apos; href=&apos;/stylesheets/style.css&apos; /&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/bootstrap/css/bootstrap.css&quot;&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;/bootstrap/js/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/bootstrap/js/bootstrap.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;%- include(&apos;./header.ejs&apos;,&#123;title: &quot;register&quot;,elsetitle:&quot;login&quot;&#125;)%&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    	&lt;form method=&quot;post&quot; action=&quot;/register/validate&quot;&gt;</span><br><span class="line">    	  &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">    	    &lt;label for=&quot;exampleInputEmail1&quot;&gt;Email address&lt;/label&gt;</span><br><span class="line">    	    &lt;input type=&quot;text&quot; class=&quot;form-control&quot; placeholder=&quot;Username&quot; name=&quot;username&quot;&gt;</span><br><span class="line">    	  &lt;/div&gt;</span><br><span class="line">    	  &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">    	    &lt;label for=&quot;exampleInputPassword1&quot;&gt;Password&lt;/label&gt;</span><br><span class="line">    	    &lt;input type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;exampleInputPassword1&quot; placeholder=&quot;Password&quot; name=&quot;password&quot;&gt;</span><br><span class="line">    	  &lt;/div&gt;</span><br><span class="line">    	  &lt;div class=&quot;checkbox&quot;&gt;</span><br><span class="line">    	    &lt;label&gt;</span><br><span class="line">    	      &lt;input type=&quot;checkbox&quot;&gt; Check me out</span><br><span class="line">    	    &lt;/label&gt;</span><br><span class="line">    	  &lt;/div&gt;</span><br><span class="line">    	  &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line">    	  &lt;%if(show)&#123;%&gt;</span><br><span class="line">    	  	&lt;div class=&quot;alert alert-danger&quot; role=&quot;alert&quot;&gt;用户名已被注册&lt;/div&gt;</span><br><span class="line">    	  &lt;%&#125;%&gt;</span><br><span class="line">    	&lt;/form&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>页面头部的导航栏写成独立的header.ejs文件，在使用到header的ejs中include一下，还可以在include的同时向header.ejs传入变量。想起来之前用php写公共部分再include，通过js改变页面内容的做法，简直不要太傻。</p>
<h4 id="register-js路由模块部分"><a href="#register-js路由模块部分" class="headerlink" title="register.js路由模块部分"></a>register.js路由模块部分</h4><p>路由模块中设置路由规则，也承担根据用户输入连接和操作数据库的任务。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">"../model/userModel"</span>);</span><br><span class="line"></span><br><span class="line">router.get(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	res.render(<span class="string">"register"</span>,&#123;<span class="attr">title</span>:<span class="string">"Register"</span>,<span class="attr">elsetitle</span>:<span class="string">"Login"</span>,<span class="attr">show</span>:<span class="number">0</span>&#125;);</span><br><span class="line">&#125;) </span><br><span class="line"></span><br><span class="line">router.post(<span class="string">"/validate"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">	userModel.find(&#123;</span><br><span class="line">		username:req.body.username</span><br><span class="line">	&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span>(docs.length==<span class="number">0</span>)&#123;</span><br><span class="line">			userModel.create(&#123;</span><br><span class="line">				username:req.body.username,</span><br><span class="line">				password:req.body.password</span><br><span class="line">			&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,info</span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span>(!error)&#123;</span><br><span class="line">					res.redirect(<span class="string">"/"</span>);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;)</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			res.render(<span class="string">"register"</span>,&#123;<span class="attr">title</span>:<span class="string">"Register"</span>,<span class="attr">elsetitle</span>:<span class="string">"Login"</span>,<span class="attr">show</span>:<span class="number">1</span>&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"> </span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>路由文件中引入我们事先写好的userModel（mongoose模块），以便按userModel中规定的模型检索数据库。在register.js路由模块中，get方法负责渲染页面，post方法在二级路由中实现数据库查询以及写入的操作。通过<strong>find方法</strong>检索用户提交的用户名，在<strong>回调函数</strong>中处理查询结果，<strong>error</strong>用于抛出一个错误信息，<strong>docs</strong>为查询后得出的文档数组，若docs长度为0，表示这是一个未被注册的用户名，因此调用<strong>create方法</strong>写入一个新用户信息。若docs的长度不为0，则显示 “用户名已被注册” 的消息。</p>
<h3 id="login-登录页"><a href="#login-登录页" class="headerlink" title="login - 登录页"></a>login - 登录页</h3><p>login的ejs模版和register.ejs大同小异，不再贴出赘述。</p>
<h4 id="login-js路由模块部分"><a href="#login-js路由模块部分" class="headerlink" title="login.js路由模块部分"></a>login.js路由模块部分</h4><p>login部分的路由，需要判断用户名和密码是否能在数据库中成功匹配。判断成功后，还应该为用户设置一条新的session属性，以便根据新添加的属性判断用户的登录状态，在数据库中取得用户信息。</p>
<p>login.js路由模块</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">"../model/userModel"</span>);</span><br><span class="line">router.get(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	res.render(<span class="string">"login"</span>,&#123;<span class="attr">title</span>:<span class="string">"Login"</span>,<span class="attr">elsetitle</span>:<span class="string">"Register"</span>,<span class="attr">show</span>:<span class="number">0</span>&#125;);</span><br><span class="line">&#125;) </span><br><span class="line">router.post(<span class="string">"/validate"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	userModel.find(&#123;</span><br><span class="line">		email:req.body.email,</span><br><span class="line">		password:req.body.password</span><br><span class="line">	&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error, docs</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(docs.length==<span class="number">0</span>)&#123;</span><br><span class="line">			res.render(<span class="string">"login"</span>,&#123;<span class="attr">title</span>:<span class="string">"Login"</span>,<span class="attr">elsetitle</span>:<span class="string">"Register"</span>,<span class="attr">show</span>:<span class="number">1</span>&#125;);</span><br><span class="line">		&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">			req.session.userInfo = docs[<span class="number">0</span>];</span><br><span class="line">			res.redirect(<span class="string">"/"</span>) </span><br><span class="line">		&#125;</span><br><span class="line"> 	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>get方法渲染登录页面，post请求中接收用户输入，若用户登录成功，那么为这个session新添一个属性userInfo并跳转至首页，若登录失败则在页面上显示错误消息。</p>
<h2 id="博客的增删改查"><a href="#博客的增删改查" class="headerlink" title="博客的增删改查"></a>博客的增删改查</h2><h3 id="准备博客模型"><a href="#准备博客模型" class="headerlink" title="准备博客模型"></a>准备博客模型</h3><p>在用户登录之后，可以撰写、发表博客。博客内容和信息存储在MongoDB中，在model文件夹中建立mongoose模型</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// article model</span></span><br><span class="line"><span class="keyword">var</span> mongoose =<span class="built_in">require</span>(<span class="string">"mongoose"</span>);</span><br><span class="line"><span class="keyword">var</span> Schema= mongoose.Schema;</span><br><span class="line"><span class="keyword">var</span>  obj = &#123;</span><br><span class="line">	author:<span class="built_in">String</span>,</span><br><span class="line">	title:<span class="built_in">String</span>,</span><br><span class="line">	content:<span class="built_in">String</span>,</span><br><span class="line">	createTime:<span class="built_in">Date</span>,</span><br><span class="line">    category: <span class="built_in">String</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> model = mongoose.model(<span class="string">"article"</span> ,<span class="keyword">new</span> Schema(obj));</span><br><span class="line"><span class="built_in">module</span>.exports = model;</span><br></pre></td></tr></table></figure>
<p>author，title，content，createTime为博客的基本信息，category为博客添加分类信息。</p>
<h3 id="首页显示博客列表"><a href="#首页显示博客列表" class="headerlink" title="首页显示博客列表"></a>首页显示博客列表</h3><p>首页提供对未登录或非博主用户展示博客列表功能，对博主提供删改接口。此外，添加销毁路由的操作。</p>
<h4 id="index-js路由模块部分"><a href="#index-js路由模块部分" class="headerlink" title="index.js路由模块部分"></a>index.js路由模块部分</h4><p>index路由判断用户登录状态及用户权限，读取保存在数据库中的博客列表传输给index.ejs模版，最终显示在用户界面上。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> articleModel =<span class="built_in">require</span>(<span class="string">"../model/articlemodel"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(req.session.userInfo)&#123;</span><br><span class="line">		articleModel.find(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">			res.render(<span class="string">'index'</span>, &#123; <span class="attr">title</span>: <span class="string">'Express'</span> ,<span class="attr">welcome</span>:req.session.userInfo.username,</span><br><span class="line">				list:docs,<span class="attr">show</span>:<span class="number">1</span></span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		articleModel.find(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">			res.render(<span class="string">'index'</span>, &#123; <span class="attr">title</span>: <span class="string">'Express'</span> ,<span class="attr">welcome</span>:<span class="literal">null</span>,</span><br><span class="line">				list:docs,<span class="attr">show</span>:<span class="number">0</span></span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//destroy session</span></span><br><span class="line">router.get(<span class="string">"/logout"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	req.session.destroy(<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!error)&#123;</span><br><span class="line">			res.redirect(<span class="string">'/login'</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>get方法中首先读取用户登录状态，若存在则显示欢迎标签，同时在页面上增加对当前用户博客内容的删改功能，若是未登录用户，则仅能查看当前博客列表。</p>
<h4 id="index-ejs模版部分"><a href="#index-ejs模版部分" class="headerlink" title="index.ejs模版部分"></a>index.ejs模版部分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;%= title %&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/bootstrap/css/bootstrap.css&quot;&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;/bootstrap/js/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/bootstrap/js/bootstrap.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;%- include(&apos;./header.ejs&apos;,&#123;title: &quot;index&quot;,elsetitle:&quot;article&quot;&#125;)%&gt;</span><br><span class="line">    </span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">		&lt;%if(show)&#123;%&gt;</span><br><span class="line">    	&lt;p&gt;Welcome back! &lt;%= welcome %&gt;&lt;/p&gt;</span><br><span class="line">    	 &lt;%&#125;%&gt;</span><br><span class="line">	    &lt;table class=&quot;table table-striped table-bordered &quot;&gt;</span><br><span class="line">        	&lt;caption&gt;Optional table caption.&lt;/caption&gt;</span><br><span class="line">        	&lt;thead&gt;</span><br><span class="line">        		&lt;tr&gt;</span><br><span class="line">        		  &lt;th&gt;作者&lt;/th&gt;</span><br><span class="line">        		  &lt;th&gt;标题&lt;/th&gt;</span><br><span class="line">        		  &lt;th&gt;创建时间&lt;/th&gt;</span><br><span class="line">                  &lt;th&gt;分类&lt;/th&gt;</span><br><span class="line">        		  &lt;%if(show)&#123;%&gt;</span><br><span class="line">        		  &lt;th&gt;操作&lt;/th&gt;</span><br><span class="line">        		  &lt;%&#125;%&gt;</span><br><span class="line">        		&lt;/tr&gt;</span><br><span class="line">        	&lt;/thead&gt;</span><br><span class="line">        	&lt;tbody&gt;</span><br><span class="line">        		&lt;%for(var i=0;i&lt;list.length;i++) &#123; %&gt;</span><br><span class="line">        			&lt;tr id=&quot;&lt;%= list[i]._id %&gt;&quot;&gt;</span><br><span class="line">        				&lt;th scope=&quot;row&quot;&gt;&lt;%= list[i].author%&gt;&lt;/th&gt;</span><br><span class="line">        				&lt;td&gt;&lt;%= list[i].title%&gt;&lt;/td&gt;</span><br><span class="line">        				&lt;td&gt;&lt;%= list[i].createTime%&gt;&lt;/td&gt;</span><br><span class="line">                        &lt;td&gt;&lt;%= list[i].category%&gt;&lt;/td&gt;</span><br><span class="line">        				&lt;%if(show)&#123;%&gt;</span><br><span class="line">        				&lt;td&gt;</span><br><span class="line">        					&lt;a class=&quot;btn btn-default&quot; role=&quot;button&quot; href=&quot;/update/&lt;%= list[i]._id %&gt;&quot; id=&quot;update&quot;&gt;更新&lt;/a&gt;</span><br><span class="line">        					&lt;a class=&quot;btn btn-danger&quot; role=&quot;button&quot; href=&quot;/remove/&lt;%= list[i]._id %&gt;&quot; id=&quot;delete&quot;&gt;删除&lt;/a&gt;</span><br><span class="line">        				&lt;/td&gt;</span><br><span class="line">						 &lt;%&#125;%&gt;</span><br><span class="line">        			&lt;/tr&gt;</span><br><span class="line">        		&lt;%&#125;%&gt;</span><br><span class="line">        	&lt;/tbody&gt;</span><br><span class="line">	    &lt;/table&gt;</span><br><span class="line">        </span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>在此指出，index.ejs模版中使用ejs语法中的for循环创建表格，同时将当次循环中的博客的id写入对应的tr的id属性以及删除按钮的href属性中去，这样当用户点击删除时才能告知服务器具体需要删除哪篇博客。后面查寻博客时则通过事件代理取tr的id值确定路由。</p>
<p>article模版展示编写博客的页面，新建博客和更新博客共用此模版。</p>
<h4 id="article-ejs模版部分"><a href="#article-ejs模版部分" class="headerlink" title="article.ejs模版部分"></a>article.ejs模版部分</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;&lt;/title&gt;</span><br><span class="line">    &lt;link rel=&quot;stylesheet&quot; href=&quot;/bootstrap/css/bootstrap.css&quot;&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;/bootstrap/js/jquery-3.3.1.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script type=&quot;text/javascript&quot; src=&quot;/bootstrap/js/bootstrap.js&quot;&gt;&lt;/script&gt;</span><br><span class="line"></span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">  	&lt;%- include(&quot;header.ejs&quot;,&#123;title:&quot;write&quot;,elsetitle:&quot;logout&quot;,show:0&#125;)%&gt;</span><br><span class="line">   	&lt;div class=&quot;container&quot;&gt;</span><br><span class="line">   		&lt;form action=&quot;/article&quot; method=&quot;post&quot;&gt;</span><br><span class="line">   		 </span><br><span class="line">   		  &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">   		    &lt;label for=&quot;exampleInputEmail1&quot;&gt;标题&lt;/label&gt;</span><br><span class="line">   		    &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;exampleInputEmail1&quot; name=&quot;title&quot; placeholder=&quot;title&quot; value=&quot;&lt;%= art_title%&gt;&quot;&gt;</span><br><span class="line">   		  &lt;/div&gt;</span><br><span class="line">        &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">          &lt;label for=&quot;exampleInputEmail1&quot;&gt;分类&lt;/label&gt;</span><br><span class="line">          &lt;input type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;exampleInputEmail1&quot; name=&quot;category&quot; placeholder=&quot;category&quot; value=&quot;&lt;%= art_category%&gt;&quot;&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">   		  &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">   		    &lt;label for=&quot;exampleInputPassword1&quot;&gt;内容 &lt;/label&gt;</span><br><span class="line">   		   &lt;textarea rows=&quot;4&quot; class=&quot;form-control&quot; name=&quot;content&quot;&gt;&lt;%= art_content%&gt;&lt;/textarea&gt;</span><br><span class="line">   		  &lt;/div&gt;</span><br><span class="line">   		  &lt;button type=&quot;submit&quot; class=&quot;btn btn-default&quot;&gt;Submit&lt;/button&gt;</span><br><span class="line"></span><br><span class="line">   		  </span><br><span class="line">   		&lt;/form&gt;</span><br><span class="line">   	&lt;/div&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<h3 id="增-编写博客"><a href="#增-编写博客" class="headerlink" title="增 - 编写博客"></a>增 - 编写博客</h3><p>在routes文件夹中新建article.js路由模块，在views文件夹下新建article.ejs模版文件，生成编写博客页面。</p>
<h4 id="article-js路由模块部分"><a href="#article-js路由模块部分" class="headerlink" title="article.js路由模块部分"></a>article.js路由模块部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> articleModel =<span class="built_in">require</span>(<span class="string">"../model/articlemodel"</span>);</span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(req.session.userInfo)&#123;</span><br><span class="line">		res.render(<span class="string">'article'</span>);</span><br><span class="line">	&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">		res.redirect(<span class="string">"/login"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">router.post(<span class="string">"/"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	articleModel.create(&#123;</span><br><span class="line">		author: req.session.userInfo.username,</span><br><span class="line">		title: req.body.title,</span><br><span class="line">		content: req.body.content,</span><br><span class="line">		createTime: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">		category: req.body.category</span><br><span class="line">	&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,info</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!error)&#123;</span><br><span class="line">			res.redirect(<span class="string">"/"</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>get方法中，先通过session的userInfo属性判断用户是否登入，若为已登录用户则加载article页面，若为未登录用户则跳转登录页。</p>
<p>post方法中，接收用户输入，将用户编写的博客内容保存到MongoDB中。</p>
<h3 id="删-删除博客"><a href="#删-删除博客" class="headerlink" title="删 - 删除博客"></a>删 - 删除博客</h3><p>使用动态路由的方式完成删除博客的操作。首页对已登录博主用户提供删除博客接口，当点击删除时，将被点击的博客的id当作路由地址通过get方式传给remove.js路由模块，在remove.js中通过deleteOne()方法安全删除博客。</p>
<h4 id="remove-js路由模块部分"><a href="#remove-js路由模块部分" class="headerlink" title="remove.js路由模块部分"></a>remove.js路由模块部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> articleModel =<span class="built_in">require</span>(<span class="string">"../model/articlemodel"</span>);</span><br><span class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">"../model/userModel"</span>);</span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">"/:id"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	<span class="comment">// console.log(req.session.userInfo);</span></span><br><span class="line">	articleModel.deleteOne(&#123;</span><br><span class="line">		_id: req.params.id</span><br><span class="line">	&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!error)&#123;</span><br><span class="line">			articleModel.find(&#123;&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">				res.render(<span class="string">'index'</span>, &#123; <span class="attr">title</span>: <span class="string">'Express'</span> ,<span class="attr">welcome</span>:req.session.userInfo.username,</span><br><span class="line">							list:docs,<span class="attr">show</span>:<span class="number">1</span></span><br><span class="line">				&#125;);</span><br><span class="line">			&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>在express中，获取不同方式提交的数据的方法分以下几种。</p>
<ul>
<li>req.params获取动态路由字段。</li>
<li>req.query获取get查询字段。</li>
<li>req.body获取post字段。</li>
</ul>
<p>在删除路由模块后，需要再执行一次find()操作，否则首页的博客列表将为空。</p>
<h3 id="改-更新博客"><a href="#改-更新博客" class="headerlink" title="改 - 更新博客"></a>改 - 更新博客</h3><p>更新博客也使用动态路由的方法。和删除操作很类似。需要注意的是更新博客需要获取原有的博客填充进article.ejs模版中。</p>
<h4 id="update-js路由模块部分"><a href="#update-js路由模块部分" class="headerlink" title="update.js路由模块部分"></a>update.js路由模块部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> articleModel =<span class="built_in">require</span>(<span class="string">"../model/articlemodel"</span>);</span><br><span class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">"../model/userModel"</span>);</span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line"></span><br><span class="line">router.get(<span class="string">"/:id"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	articleModel.find(&#123;</span><br><span class="line">		_id: req.params.id</span><br><span class="line">	&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="keyword">if</span>(!error)&#123;</span><br><span class="line">			res.render(<span class="string">'article'</span>,&#123;<span class="attr">art_title</span>:docs[<span class="number">0</span>].title,<span class="attr">art_content</span>:docs[<span class="number">0</span>].content,<span class="attr">art_category</span>:docs[<span class="number">0</span>].category&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>更改之后仍使用编写博客时的方式提交博客，博客的createtime属性也将更新为最后一次提交更新的时间。</p>
<h3 id="查-查看博客"><a href="#查-查看博客" class="headerlink" title="查 - 查看博客"></a>查 - 查看博客</h3><p>在index.ejs中对展示博客列表的table标签添加事件代理。监听每个tr的点击事件跳转到check路由上。</p>
<p>index.ejs添加</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">"text/javascript"</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">        $(<span class="string">'tbody'</span>).on(<span class="string">'click'</span>,<span class="string">"tr"</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            location.href = <span class="string">'/check/'</span>+$(<span class="keyword">this</span>).attr(<span class="string">'id'</span>);</span></span><br><span class="line"><span class="undefined">        &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在for循环输出博客列表时，事先给每个tr的id属性都设置成了博客的id。</p>
<h4 id="check-js路由模块部分"><a href="#check-js路由模块部分" class="headerlink" title="check.js路由模块部分"></a>check.js路由模块部分</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">'express'</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="keyword">var</span> articleModel =<span class="built_in">require</span>(<span class="string">"../model/articlemodel"</span>);</span><br><span class="line"><span class="keyword">var</span> userModel = <span class="built_in">require</span>(<span class="string">"../model/userModel"</span>);</span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">"/:id"</span>,<span class="function"><span class="keyword">function</span>(<span class="params">req,res</span>)</span>&#123;</span><br><span class="line">	articleModel.find(&#123;</span><br><span class="line">		_id: req.params.id</span><br><span class="line">	&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error,docs</span>)</span>&#123;</span><br><span class="line">		<span class="keyword">if</span>(!error)&#123;</span><br><span class="line">			res.render(<span class="string">'check'</span>,&#123;<span class="attr">title</span>:<span class="string">"blog"</span>,<span class="attr">show</span>:<span class="number">0</span>,<span class="attr">art_title</span>:docs[<span class="number">0</span>].title,<span class="attr">art_content</span>:docs[<span class="number">0</span>].content,<span class="attr">art_category</span>:docs[<span class="number">0</span>].category&#125;);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>
<p>这应该是最简单的一个模块吧。find一下然后传给check.ejs模版就好了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>至此，已经实现了一个简单的可以登录注册增删改查博文的小博客，但还缺少分类、评论等功能。第一次记叙小项目的实现过程，行文不免凌乱缺乏条理，章节安排参考了@liuxing的github项目<a href="https://github.com/liuxing/node-blog" target="_blank" rel="noopener">node-blog</a>，项目代码已上传我的github <a href="https://github.com/flycatrix/express-blog" target="_blank" rel="noopener">express-blog</a>。此外，由于对代码的理解较浅，表述不当之处，还望不吝赐教。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>, <a href="/tags/NodeJS/">NodeJS</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-06-10T06:52:35.000Z"><a href="/2018/06/10/关于JavaScript模块化开发的梳理/">2018-06-10</a></time>
      
      
  
    <h1 class="title"><a href="/2018/06/10/关于JavaScript模块化开发的梳理/">关于JavaScript模块化开发的梳理</a></h1>
  

    </header>
    <div class="entry">
      
        <h2 id="commonJS"><a href="#commonJS" class="headerlink" title="commonJS"></a>commonJS</h2><p>&emsp;&emsp;在我对js的理解还停留在只用来做做页面认证和特效的时候，它早已牛逼到支持操作系统层面的操作了。根据学习整理，大致梳理出这么一个故事 —— 虽然js天生的弱类型和半吊子面向对象的特性在逐步向强类型语言靠拢，但js没有模块系统、标准库较少、没有包管理工具的痛点阻碍着js发展出开发大型应用的能力。于是<a href="http://www.commonjs.org/" target="_blank" rel="noopener">commonJS</a>跳出来尝试解决这个问题。<a href="http://www.commonjs.org/" target="_blank" rel="noopener">commonJS</a>的首页上就写着</p>
<blockquote>
<p>javascript: not just for browsers any more !</p>
</blockquote>
<p>可见<a href="http://www.commonjs.org/" target="_blank" rel="noopener">commonJS</a>是希望Js运行在浏览器以外发挥作用的。</p>
<p>&emsp;&emsp;<a href="http://www.commonjs.org/" target="_blank" rel="noopener">commonJS</a>针对JS模块化开发制定了一系列规范，主要包括模块引用、模块定义、模块标识。规范仅仅是规范，亦可以说是指导，而node.js实现了它。nodejs把Chrome V8从浏览器中剥离出来，又编写了一部分底层代码，添加了对I/O操作的支持，js获得了在操作系统层面的运行能力，于是浏览器框不住js了。</p>
<p>&emsp;&emsp;在commonJS中，一个文件就是一个模块，拥有单独的作用域， 普通方式定义的变量、函数、对象都属于该模块内，因为所有代码都运行在局部作用域内，因此避免了污染全局作用域的问题。模块可以多次加载但只会运行一次，此后模块被缓存起来可以被直接调用，模块的加载顺序由书写顺序决定，以同步的方式加载。</p>
<p>&emsp;&emsp;但commonJS旨在使js获得在服务端开发的能力，因此模块规范的订制都采用同步的方式，但在浏览器中，同步意味着用户必须等待程序的执行、加载等步骤，由此造成严重的用户体验和使用性能问题。那么浏览器中js程序的模块化规范怎么办呢？</p>
<h2 id="AMD和CMD"><a href="#AMD和CMD" class="headerlink" title="AMD和CMD"></a>AMD和CMD</h2><p>&emsp;&emsp;实际上，为了达到浏览器端模块化开发的目的，目前有两种常用的规范——AMD（Asynchronous Module Definition）和CMD（Common Module Definition ）。引用玉伯大佬在知乎上的解释。</p>
<blockquote>
<p>AMD 是 RequireJS 在推广过程中对模块定义的规范化产出。</p>
<p> CMD 是 SeaJS 在推广过程中对模块定义的规范化产出。 </p>
</blockquote>
<p>&emsp;&emsp;AMD和CMD均实现了异步模块加载，但有其各自的特点。</p>
<h3 id="AMD"><a href="#AMD" class="headerlink" title="AMD"></a>AMD</h3><p>&emsp;&emsp;RequireJS应用的异步加载模块规范，需要注意的是，依赖必须在模块开头写明。AMD主要提供define和require两个方法来进行模块化编程 ，define用于定义模块，require用于引入模块。</p>
<h4 id="AMD的define"><a href="#AMD的define" class="headerlink" title="AMD的define"></a>AMD的define</h4><p>&emsp;&emsp;define用于定义模块，通过return对象来暴露内部定义的属性和方法，实际上应用的就是采用 匿名函数模块化开发 的思路。关于基本js模块化开发的介绍可移步另一篇博客 —— <a href="http://blog.xcola.top/2018/05/23/%E5%85%B3%E4%BA%8Ejavascript%E6%A8%A1%E5%9D%97%E5%8C%96%E5%BC%80%E5%8F%91/" target="_blank" rel="noopener">关于javascript模块化开发</a></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func1</span> (<span class="params">args</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//....</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func2</span> (<span class="params">args1,args2</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        func1: func1,</span><br><span class="line">        func2: func2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;当模块独立运行不需要依赖别的模块时，上面的代码是可行的。当模块之间存在依赖时，需要在define中以数组的方式指明依赖的模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">define([<span class="string">'./modules1'</span>,<span class="string">'./modules2'</span>,..],<span class="function"><span class="keyword">function</span>(<span class="params">m1,m2,...</span>)</span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func1</span> (<span class="params">args</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//可调用modules1、modules2中的方法</span></span><br><span class="line">        <span class="keyword">return</span> m1.func1(args);</span><br><span class="line">    &#125; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func2</span> (<span class="params">args1,args2</span>)</span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        func1: func1,</span><br><span class="line">        func2: func2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;可以看出，在添加了依赖的模块后，define的回调函数中指定了几个形参，这几个形参即为各模块中返回的对象，因此可以通过调用形参的方法获得别的模块中定义的功能。</p>
<h4 id="AMD的require"><a href="#AMD的require" class="headerlink" title="AMD的require"></a>AMD的require</h4><p>&emsp;&emsp;require用于引入模块，语法也与define相近，处理亦置于回调函数中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="string">'./modules1'</span>,<span class="string">'./modules2'</span>,..],<span class="function"><span class="keyword">function</span>(<span class="params">m1,m2,..</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="AMD的调用方式"><a href="#AMD的调用方式" class="headerlink" title="AMD的调用方式"></a>AMD的调用方式</h4><p>&emsp;&emsp;RequireJS的调用采取标签的形式，标签中指定入口。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">data-main</span>=<span class="string">'./scripts/main'</span> <span class="attr">src</span>=<span class="string">'./scripts/require.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;data-main指定了模块的入口，这里main.js即为入口，依赖模块将通过入口开始异步加载进入执行。</p>
<h3 id="CMD"><a href="#CMD" class="headerlink" title="CMD"></a>CMD</h3><p>&emsp;&emsp;这是淘宝的攻城狮玉伯开发的seaJS执行的标准，名字据说是有“ 海纳百川，有容乃大 ”的寓意。CMD和AMD都有define和require方法，但CMD实际上是不需要在require和define中指定依赖的。</p>
<h4 id="CMD的define"><a href="#CMD的define" class="headerlink" title="CMD的define"></a>CMD的define</h4><p>define的三个参数分别指明</p>
<ul>
<li><p>require – 依赖的模块（以id为标识符）（推荐就近书写）</p>
</li>
<li><p>exports – 向外界提供的接口</p>
</li>
<li><p>modules – 一个对象，存储当前模块的属性和方法【id（标识符）,uri（绝对路径）,exports（导出接口）】</p>
</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//CMD</span></span><br><span class="line">define(<span class="function"><span class="keyword">function</span>(<span class="params">require,exports,modules</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//依赖模块的使用</span></span><br><span class="line">    <span class="keyword">var</span> m1 = <span class="built_in">require</span>(<span class="string">'./modules1'</span>);</span><br><span class="line">    m1.func1();</span><br><span class="line">    <span class="comment">//导出方法</span></span><br><span class="line">    exports.func = <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 或者。。</span></span><br><span class="line">    modules.exports = &#123;</span><br><span class="line">        func: func</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h4 id="CMD的调用方式"><a href="#CMD的调用方式" class="headerlink" title="CMD的调用方式"></a>CMD的调用方式</h4><p>首先是毫无疑问的第一步。。引入seaJS。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"../sea-modules/seajs/seajs/2.2.0/sea.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>在引入seaJS后，进行基础的配置。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// seajs 的简单配置</span></span><br><span class="line">seajs.config(&#123;</span><br><span class="line">    <span class="comment">// 配置路径，Sea.js 在解析顶级标识时，会相对 base 路径来解析。</span></span><br><span class="line">  base: <span class="string">"../sea-modules/"</span>,</span><br><span class="line">    <span class="comment">// 配置别名，有了alias后可以require('jquery')，否则只能require ID</span></span><br><span class="line">  alias: &#123;		</span><br><span class="line">    <span class="string">"jquery"</span>: <span class="string">"jquery/jquery/1.10.1/jquery.js"</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 加载入口模块</span></span><br><span class="line">seajs.use(<span class="string">"../static/hello/src/main"</span>)</span><br></pre></td></tr></table></figure>
<p>当然seaJS的配置还有很多。。有个博客写的很详细，<a href="http://yslove.net/seajs/" target="_blank" rel="noopener">传送门</a>。</p>
<h3 id="CMD和AMD的区别"><a href="#CMD和AMD的区别" class="headerlink" title="CMD和AMD的区别"></a>CMD和AMD的区别</h3><p>&emsp;&emsp;至于AMD和CMD的差别，引用玉伯的描述：AMD先定义所有依赖，操作在加载完成后的回调函数中执行，而CMD依赖就近，用到什么依赖到时候再说。对于依赖的模块，AMD提前执行，CMD延后执行。（但执行AMD标准的RequireJS也已添加延迟执行的选项。）另外，AMD 的 API 默认是一个当多个用，CMD 的 API 严格区分，推崇职责单一。 </p>
<p>&emsp;&emsp;CMD的哲学是 as lazy as possible，emm深得我心。。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-31T13:32:29.000Z"><a href="/2018/05/31/jQuery-core-js阅读笔记/">2018-05-31</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/31/jQuery-core-js阅读笔记/">jQuery-core.js（整体架构部分）阅读笔记</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;突然有了看看jQuery源码的念头。毕竟同样是js，为什么jQuery可以实现那么多方便易用的特性，同时也希望在拜读源码的过程中，能学习到一些关于构建库和模块的思路。</p>
<p>&emsp;&emsp;源码下载自github，目前为最新版3.3.1，先从总体架构看起 —— core,js。摘取部分并整理一下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jQuery = <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;		</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context );			</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> quickExpr = <span class="regexp">/^[^&lt;]*(&lt;(.|\s)+&gt;)[^&gt;]*$|^#(\w+)$/</span>,	</span><br><span class="line">	isSimple = <span class="regexp">/^.[^:#\[\.]*$/</span>,</span><br><span class="line">	<span class="literal">undefined</span>;	</span><br><span class="line">jQuery.fn = jQuery.prototype = &#123;			</span><br><span class="line">	init: <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;&#125;,</span><br><span class="line">    </span><br><span class="line">    	size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 返回jq对象中个元素个数</span></span><br><span class="line">    	get: <span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 以类似数组索引的方法取得一个jq对象中的元素</span></span><br><span class="line">    	pushStack: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 将一个元素压入jq栈</span></span><br><span class="line">    	each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 迭代器，可遍历数组和对象</span></span><br><span class="line">    	index: <span class="function"><span class="keyword">function</span>(<span class="params"> elem </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 搜寻指定元素，返回其位置</span></span><br><span class="line">    	attr: <span class="function"><span class="keyword">function</span>(<span class="params"> name, value, type </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 获取匹配元素集合中第一个元素的属性值，或为每个匹配元素设置一个或多个属性</span></span><br><span class="line">    	css: <span class="function"><span class="keyword">function</span>(<span class="params"> key, value </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 获取匹配元素中第一个元素的样式或者给指定的元素设定CSS样式</span></span><br><span class="line">    	wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params"> html </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 在对象外部插入html标签</span></span><br><span class="line">		append: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 将由参数指定的内容插入匹配元素集合中每个元素的末尾</span></span><br><span class="line">    	find: <span class="function"><span class="keyword">function</span>(<span class="params"> selector </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 获取当前匹配元素中符合参数选择器的对象</span></span><br><span class="line">	clone: <span class="function"><span class="keyword">function</span>(<span class="params"> events </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 深拷贝一组匹配元素的值</span></span><br><span class="line">	add: <span class="function"><span class="keyword">function</span>(<span class="params"> selector </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 以给定的参数创建一个新的jq对象</span></span><br><span class="line">	is: <span class="function"><span class="keyword">function</span>(<span class="params"> selector </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 根据给定的条件检查当前匹配元素，存在匹配时返回true</span></span><br><span class="line">	val: <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 返回当前元素的value值</span></span><br><span class="line">	html: <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 返回或设定当前元素的html标签内容</span></span><br><span class="line">	replaceWith: <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 用提供的内容替换当前匹配元素</span></span><br><span class="line">	eq: <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 以索引的方式取得一组jq对象中的某一个对象</span></span><br><span class="line">	slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 和数组的slice方法类似，可以缩小当前jq对象数组的范围</span></span><br><span class="line">	map: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 和数组的map方法类似</span></span><br><span class="line">	data: <span class="function"><span class="keyword">function</span>(<span class="params"> key, value </span>)</span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 向dom元素附加一个数据（键值对）</span></span><br><span class="line">	domManip: <span class="function"><span class="keyword">function</span>(<span class="params"> args, table, reverse, callback </span>) </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">	<span class="comment">// dom操作的核心函数</span></span><br><span class="line">jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line">	<span class="comment">// 把jQuery的原型传递给init的原型</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;首先在全局注册jQuery变量（$），随后此变量指向jq的构造函数。有个很有意思的小地方 ——  定义了一个变量叫 undefined，由于没给它赋值，因此它的值也是undefined。这样做的意义可以分为两个方面，首先它减少了程序在作用域链中搜寻undefined值的时间，其次也在防范用户有意无意的改变undefined的值（undefined是可以赋值的，但谷歌浏览器会忽视用户给undefined的赋值）。</p>
<p>&emsp;&emsp;值得学习的是，在构造函数中 “return new ” 的方法使得jq获得了无new构造jq对象的特性，但是，如果直接return 自己的构造函数无疑会造成无限递归自己的问题。如下所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.selector = selector;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> jQuery(selector);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;因此这个构造函数把构造对象的任务交给了jQuery.fn.init函数。jQuery.fn.init实际上是jQuery.prototype.init，在这个过程中，分离出两个不同的构造器 —— jQuery.prototype和jQuery.prototype.init.prototype。到了这里虽然解决了无new操作且避免递归的问题，也自然而然引出另一个问题 —— 构建jq对象的任务是在jQuery.prototype.init.prototype中完成的，所以构建出的对象其原型会指向jQuery.prototype.init.prototype而不是jQuery.prototype，其this也无法引用到jQuery的原型方法。</p>
<p>&emsp;&emsp;比如，在jQuery.prototype中，还有很多种方法，在上面的代码块中仅列出一部分函数的声明，注释中给出了每个方法的作用。这些方法均为实例方法，实例化出的jq对象即可调用。</p>
<p>&emsp;&emsp;另外，jQuery本身还存在很多静态方法，这些方法由jQuery直接调用，例如扩展方法（extend）。可以发现，在这其中存在静态和实例方法中有共用的方法，即既是静态方法，也是实例方法，举个栗子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> jQuery.each( <span class="keyword">this</span>, callback, args );</span><br><span class="line">	&#125;,</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;each方法可以被实例化的对象调用也可以被jQuery本身调用。且这个静态方法的实现还依赖于实例方法。但jq实例是通过init构造器构造的，init构造器和jQuery构造器又是分离的，那么怎么解决这个问题呢，在这段程序的最后。</p>
<p><code>jQuery.fn.init.prototype = jQuery.fn;</code></p>
<p>&emsp;&emsp;把jQuery的原型传递给init的原型，这样jQuery.prototype.init.prototype会指向jQuery.prototype，事实上也就是jQuery的原型对象覆盖了init构造器的原型对象。通过这种方法，将两个分离的构造器整合在了一起。当用户使用$()时，首先通过init构造器创建了一个jq对象，其次通过jQuery.fn.init.prototype = jQuery.fn的方法将实例方法挂载，静态方法又依赖于实例方法才得以实现，至此，通过init构造器完成了无new化jq对象的构建、通过init和jQuery的原型传递实现了实例方法挂载、在实例方法中call或者apply方法又实现了jQuery静态方法的挂载。</p>
<p>&emsp;&emsp;这一部分原理和思路是我在参考了很多前辈和大神的分析讲解后才得以勉强理解。在构建对象的核心模块上尽显其思路之巧妙写法之风骚。此外，core.js中在实例方法和静态方法的处理中展现出的编程技巧也十分值得学习。阅读源码过程艰难，基本就处于理解偏差乃至根本看不懂的尴尬境地，但希望拜读之后，这些思路和技巧亦能成为我的血肉。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>, <a href="/tags/jQuery/">jQuery</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-26T10:19:42.000Z"><a href="/2018/05/26/对ajax的理解/">2018-05-26</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/26/对ajax的理解/">对ajax的理解</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;先来引用一段mdn对ajax的描述。</p>
<blockquote>
<p>(ajax)（异步JavaScript和XML）Asynchronous JavaScript + XML, 其本身不是一种新技术，而是一个在 2005年被Jesse James Garrett提出的新术语，用来描述一种使用现有技术集合的‘新’方法，包括: HTMLor XHTML, Cascading Style Sheets, JavaScript, The Document Object Model, XML, XSLT, 以及最重要的 XMLHttpRequest object。当使用结合了这些技术的AJAX模型以后， 网页程序能够快速地将渐步更新呈现在用户界面上，不需要重载（刷新）整个页面。这使得程序能够更快地回应用户的操作。</p>
</blockquote>
<p>&emsp;&emsp;ajax相当于在浏览器和服务器之间加了一层代理，使得浏览器请求和服务器响应异步化，将一部分请求暂存，当需要从服务器读取新数据时再由ajax代为处理，最终做到让我们在不重载页面的情况下读写服务器上的数据 。</p>
<h3 id="ajax的使用"><a href="#ajax的使用" class="headerlink" title="ajax的使用"></a>ajax的使用</h3><p>&emsp;&emsp;谈谈原生js对ajax使用，js提供了一个api来使用ajax——XMLHttpRequest。在使用ajax之前，需要构造一个XMLHttpRequest对象。</p>
  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;既然是一个对象，那么就会从它的构造函数中继承到一些属性和方法，这些属性和方法控制和说明ajax请求的状态，以及异步请求的方式、等等。</p>
<h4 id="向服务器发送请求的方法"><a href="#向服务器发送请求的方法" class="headerlink" title="向服务器发送请求的方法"></a>向服务器发送请求的方法</h4><p>&emsp;&emsp;既然是异步加载，终究还是需要向服务器请求数据的，异步体现在请求的时机和内容由js动态控制。XMLHttpRequest对象提供了open()和send()方法。这两个方法在工作内容上是顺接的，open方法规定请求的内容、URL（统一资源定位符，表明请求的资源地址）、以及是否异步处理请求。而send方法完成将请求发送到服务器的操作。</p>
<h5 id="open"><a href="#open" class="headerlink" title="open()"></a>open()</h5><p>&emsp;&emsp;open函数初始化一个请求，准备好请求的内容后由send函数发送。一个请求需要很多参数才能被准确说明，这些说明应当通过参数的方式传给open方法。</p>
<h6 id="method"><a href="#method" class="headerlink" title="method"></a>method</h6><p>&emsp;&emsp;说明请求使用的http方法，包括 “GET”, “POST”, “PUT”, “DELETE” 等等，虽然我是在不同的书上看到过put和delete请求，然而我是没见过这两种请求。。</p>
<h6 id="url"><a href="#url" class="headerlink" title="url"></a>url</h6><p>&emsp;&emsp;当前请求的资源地址。</p>
<h6 id="async"><a href="#async" class="headerlink" title="async"></a>async</h6><p>&emsp;&emsp;是否异步。true那么异步，false那么同步。这里要注意的是，如果该请求是异步模式，send()会立刻返回。相反，如果请求是同步模式，则直到请求的响应完全接受以后，该方法才会返回。</p>
<h6 id="user"><a href="#user" class="headerlink" title="user"></a>user</h6><p>&emsp;&emsp;用户名。这是个可选的参数。</p>
<h6 id="password"><a href="#password" class="headerlink" title="password"></a>password</h6><p>&emsp;&emsp;密码。有了用户名当然就有密码。。也是个可选的参数。</p>
<p>&emsp;&emsp;user和password我还没使用过，但是回想之前在linux系统下登录内网用户认证的时候，用过curl命令发送post请求，后面是需要带上user和password的，这个两个参数应该同理。</p>
<h5 id="send"><a href="#send" class="headerlink" title="send()"></a>send()</h5><p>&emsp;&emsp;send函数相对就简单一些，参数只用于post请求，功能是将设定好的请求发送出去。send函数也可以传递post参数，但是在传参时往往会将参数序列化（如果参数是文档），或者在遇到空格等特殊字符时被截断，因此通常会先将send中发送的参数encode一下。</p>
<h4 id="XMLHttpRequest的属性"><a href="#XMLHttpRequest的属性" class="headerlink" title="XMLHttpRequest的属性"></a>XMLHttpRequest的属性</h4><p>&emsp;&emsp;在整个响应的过程中，js需要判断响应的状态才能做出处理。XMLHttpRequest的属性提供了一些说明请求状态以及处理的方法。</p>
<h5 id="readystate"><a href="#readystate" class="headerlink" title="readystate"></a>readystate</h5><p>&emsp;&emsp;这是一个数值类型的属性，其值说明了请求的5中状态。</p>
<ul>
<li><p>0 未开始         open()尚未调用</p>
</li>
<li><p>1 未发送         open()已经被调用，但send()未调用</p>
</li>
<li><p>2  获取响应头 send()已经被调用，响应状态（status）和响应头已获取</p>
</li>
<li><p>3 下载响应体  正在下载responseText</p>
</li>
<li><p>4 请求完成      整个响应已经结束</p>
</li>
</ul>
<h5 id="status"><a href="#status" class="headerlink" title="status"></a>status</h5><p>&emsp;&emsp;这个属性说明了请求的响应状态码，即Http协议返回的消息响应码。摘取如下。这个属性是只读的。</p>
<ul>
<li>1xx:信息响应类，表示接收到请求并且继续处理</li>
<li>2xx:处理成功响应类，表示动作被成功接收、理解和接受</li>
<li>3xx:<a href="https://baike.baidu.com/item/%E9%87%8D%E5%AE%9A%E5%90%91" target="_blank" rel="noopener">重定向</a>响应类，为了完成指定的动作，必须接受进一步处理</li>
<li>4xx:客户端错误，客户请求包含语法错误或者是不能正确执行</li>
<li>5xx:服务端错误，服务器不能正确执行一个正确的请求</li>
</ul>
<h5 id="onreadystatechange"><a href="#onreadystatechange" class="headerlink" title="onreadystatechange"></a>onreadystatechange</h5><p>&emsp;&emsp;这是一个函数对象，只看名字应该也能猜到它的作用——当readyState属性改变时会调用它。在js中也依赖于这个函数在每次响应状态改变时判断响应是否结束，当响应成功且结束时读取响应文本，进行下一步的处理和操作。</p>
<h5 id="responseText"><a href="#responseText" class="headerlink" title="responseText"></a>responseText</h5><p>&emsp;&emsp;当响应成功且结束时，这个属性即为服务器响应的文本。</p>
<h4 id="来一段代码看看"><a href="#来一段代码看看" class="headerlink" title="来一段代码看看"></a>来一段代码看看</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ajax_request</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">    xhr.open(<span class="string">'get'</span>,<span class="string">'./part.json'</span>,<span class="literal">true</span>);</span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(xhr.readystate !== <span class="number">4</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(xhr.status &gt;= <span class="number">200</span> &amp;&amp; xhr.status &lt;<span class="number">300</span>)&#123;</span><br><span class="line">            <span class="keyword">var</span> result = <span class="built_in">JSON</span>.parse(xhr.responseText);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'request error'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    xhr.send();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;1，创建一个XMLHttpRequest对象。2，open()发送请求。3，检测状态改变时进入匿名函数。4，如果响应未完成则返回。5，响应成功则继续判断响应状态，响应成功则处理响应文本，否则抛出错误。6，将请求发送，send()。嗯。</p>
<p>&emsp;&emsp;open函数将请求设定好，onreadystatechange设置了回调函数等待调用，send函数将请求发送，当有响应消息时调用onreadystatechange设置的回调函数。因此send总是放在后面。</p>
<h3 id="ajax的优点"><a href="#ajax的优点" class="headerlink" title="ajax的优点"></a>ajax的优点</h3><p>&emsp;&emsp;网页程序能够快速地将渐步更新呈现在用户界面上，不需要重载（刷新）整个页面。程序能够更快地回应用户的操作，缓冲和转移服务器压力。 。。。。。。</p>
<ul>
<li>不需要插件支持</li>
<li>优化用户体验</li>
<li>提高web性能</li>
<li>减轻服务器和带宽负担</li>
</ul>
<h3 id="ajax的缺点"><a href="#ajax的缺点" class="headerlink" title="ajax的缺点"></a>ajax的缺点</h3><p>&emsp;&emsp;ajax工作在浏览器和服务器之间，实际上也破坏了浏览器的后退和历史机制。在动态加载的情况下，浏览器无法区分静态页面和动态修改后的页面，于是用户无法通过back回到上一个页面或者取消上一次操作（插件解决）。另一个问题在于，动态页面更新使得用户难于将普通ajax页面的某个特定的状态保存到收藏夹中（url加锚点解决）。</p>
<p>&emsp;&emsp;此外，ajax对搜索引擎支持不好，爬虫难以爬取，搜索引擎也不容易搜索到动态加载的内容。今天搜索这个问题看到阮一峰大神搬运的Discourse创始人之一的Robin Ward的解决方法——<a href="http://www.ruanyifeng.com/blog/2013/07/how_to_make_search_engines_find_ajax_content.html" target="_blank" rel="noopener">阮一峰的网络日志 </a>，这种方法通过window.history使每个锚点都变成可爬取的url，膜拜一下。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-24T02:10:49.000Z"><a href="/2018/05/24/hostus搭建多用户shadowsocks/">2018-05-24</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/24/hostus搭建多用户shadowsocks/">hostus搭建多用户shadowsocks</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;emmm。。花了60多买了一年多的ss到期了。再续费一年要200，免费的翻墙软件用起来都不太称心如意。遂决心自己搭建一个。。没抢到搬瓦工的VPS于是一顿操作上了hostus的船，价格可以配置一般主要便宜而且不用paypal但是刷一次IP要5刀。</p>
<ul>
<li>CPU核心：1核心</li>
<li>内存：768MB /768MB vSwap</li>
<li>硬盘：20GB</li>
<li>端口：1Gbps</li>
<li>月流量：2000GB</li>
<li>架构/系统：OpenVZ</li>
<li>独立IP：1IP</li>
<li>价格：[$16.00/年]</li>
</ul>
<p>&emsp;&emsp;hostus的初始密码比较复杂，putty连上以后先改密码。。</p>
<p><code>passwd root</code></p>
<p>&emsp;&emsp;安装shadowsocks，这里先安装个go语言的shadowsocks，后来才发现只能找到python语言的流量管理，流量管理的事emmm以后再说吧。。</p>
<p>&emsp;&emsp;wget获取shadowsocks-go脚本。</p>
<p><code>wget --no-check-certificate https://down.upx8.com/shell/shadowsocks-go.sh</code></p>
<p>&emsp;&emsp;赋予脚本执行权限。</p>
<p><code>chmod +x shadowsocks-go.sh</code></p>
<p>&emsp;&emsp;执行脚本。</p>
<p><code>./shadowsocks-go.sh 2&gt;&amp;1 | tee shadowsocks-go.log</code></p>
<p>&emsp;&emsp;这里记录一下卸载脚本的方法。。</p>
<p><code>./shadowsocks-go.sh uninstall</code></p>
<p>&emsp;&emsp;配置多用户登录。</p>
<p><code>vi /etc/shadowsocks/config.json</code></p>
<p>&emsp;&emsp;配置文件里添加端口和对应的登录口令。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line"><span class="attr">"server"</span>:<span class="string">"0.0.0.0"</span>,</span><br><span class="line"><span class="attr">"local_address"</span>:<span class="string">"127.0.0.1"</span>,</span><br><span class="line"><span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line"><span class="attr">"port_password"</span>:&#123;</span><br><span class="line"><span class="attr">"1212"</span>:<span class="string">"password1"</span>,</span><br><span class="line"><span class="attr">"1213"</span>:<span class="string">"password2"</span>,</span><br><span class="line"><span class="attr">"1214"</span>:<span class="string">"password3"</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="attr">"timeout"</span>:<span class="number">300</span>,</span><br><span class="line"><span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line"><span class="attr">"fast_open"</span>: <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;至此，配置就算ok了。记录下shadowsocks服务的各种操作。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">启动：/etc/init.d/shadowsocks start </span><br><span class="line">停止：/etc/init.d/shadowsocks stop </span><br><span class="line">重启：/etc/init.d/shadowsocks restart </span><br><span class="line">状态：/etc/init.d/shadowsocks status</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;配置完后需要重启shadowsocks。不同用户通过不同端口以及对应的密码即可连接。</p>
<p>&emsp;&emsp;看了一眼hostus的默认服务器系统是centos6。。防火墙还是iptables。添加防火墙过滤规则，否则可能会出现端口被屏蔽服务器拒绝连接的情况。</p>
<p><code>iptables -I INPUT -p tcp --dport 1314 -j ACCEPT</code></p>
<p>&emsp;&emsp;测试了一下三个端口，都可以正常访问google。但是不完善的一点是go脚本好像没有ss流量管理，有空重装python试试。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/服务器/">服务器</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/瞎折腾/">瞎折腾</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-23T09:10:17.000Z"><a href="/2018/05/23/对闭包的理解/">2018-05-23</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/23/对闭包的理解/">对闭包的理解</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="闭包的概念"><a href="#闭包的概念" class="headerlink" title="闭包的概念"></a>闭包的概念</h3><p>&emsp;&emsp;初学闭包的时候，似懂非懂，后来看了《javascript高级程序设计》，里面对闭包的描述是</p>
<blockquote>
<p>闭包是指有权访问另一个函数作用域中的变量的的函数。</p>
</blockquote>
<p>&emsp;&emsp;在这段描述里，把闭包理解为一个函数。阮一峰大神给出了类似的理解：</p>
<blockquote>
<p>闭包就是能够读取其他函数内部变量的函数。 </p>
</blockquote>
<p>&emsp;&emsp;可以看出是有很多相似之处的。再后来，知乎有了针对阮一峰对闭包概念描述准确性的论战，粗略看完众多回答后，我又去特地查询了MDN的文档</p>
<blockquote>
<p>闭包是函数和声明该函数的词法环境的组合。 </p>
</blockquote>
<p>&emsp;&emsp;emmmm。。。不明觉厉但是觉得可能是要更准确一些。感谢同桌 @于雅楠 买了一套《你不知道的javascript》，今天看到上面关于闭包部分的描述，感觉多了一些理解。</p>
<blockquote>
<p>当函数可以记住并访问所在的词法作用域时，就产生了闭包，即使函数是在当前词法作用域之外执行。</p>
</blockquote>
<p>&emsp;&emsp;这套书从作用域和编译器以及引擎的角度分析javascript的语法以及作用原理，相比《javascript高级程序设计》更底层一些，并且觉得学习底层机制是学习一门编程语言绕不开的问题。借用书中的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> a = <span class="number">2</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(a);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> bar;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> baz = foo();</span><br><span class="line">baz(); 			<span class="comment">// 2</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;一般来说，foo函数的作用域内的变量外部是访问不到的，而bar函数能访问foo函数体内的全部作用域，当foo函数返回bar函数时，也同时向外界提供了一个访问自己内部数据的“桥梁”，于是一个闭包产生了 —— bar函数记住了声明bar函数时的词法作用域（<em>foo函数内部的作用域</em>），并访问了所在的词法作用域（<em>bar函数里引用了foo函数内bar函数外声明的变量a</em>），即使函数是在当前词法作用域之外执行（<em>bar函数在foo函数外执行</em>）。</p>
<p>&emsp;&emsp;当一个函数执行后，通常会被javascript的垃圾回收机制回收占用的资源——其创建的作用域将被销毁，而闭包阻止了回收的发生，由于bar维持着对foo函数作用域的引用，因而引擎始终认为这是一个活动着的作用域。</p>
<blockquote>
<p>bar()依然持有对该作用域的引用，该引用就叫做闭包。这个函数在定义时的词法作用域以外的地方被调用，闭包使得函数可以继续访问定义时的词法作用域。</p>
</blockquote>
<blockquote>
<p>无论通过何种手段把<strong>内部函数</strong> <em>传递</em> 到所在的词法作用域以外，它都会<strong>持有对原始定义作用域的引用</strong>，无论在何处执行这个函数都会使用闭包。</p>
</blockquote>
<p>&emsp;&emsp;我自作主张的将以上的论述拆开来看。首先要有一个需要被引用的作用域，在这个作用域内又声明了一个内部函数，且这个内部函数持有被引用的作用域内的变量，然后将这个内部函数作为返回值传递到被引用作用域的外界。那么当在调用这个内部函数时，也就获得了对内部函数所引用的作用域的访问能力。在这个过程中，内部函数起到了桥梁或者说通道的作用，不仅避免了作用域被回收，也提供了访问作用域内变量的方法。</p>
<h3 id="闭包的使用场景"><a href="#闭包的使用场景" class="headerlink" title="闭包的使用场景"></a>闭包的使用场景</h3><p>&emsp;&emsp;据说。闭包很常见。</p>
<h4 id="延时函数造成的闭包"><a href="#延时函数造成的闭包" class="headerlink" title="延时函数造成的闭包"></a>延时函数造成的闭包</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">wait</span> (<span class="params">msg</span>) </span>&#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(msg);</span><br><span class="line">    &#125;, <span class="number">1000</span>);</span><br><span class="line">&#125;</span><br><span class="line">wait(<span class="string">'emm..'</span>)</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;javascript是个单线程语言，借此讨论一下它对setTimeout的处理。引用MDN文档中的论述。</p>
<blockquote>
<p>由<code>setTimeout()</code>调用的代码运行在与所在函数完全分离的执行环境上。这会导致，这些代码中包含的 <code>this</code> 关键字在非严格模式会指向 <code>window</code> (或全局)对象，这和所期望的<code>this</code>的值是不一样的。 </p>
</blockquote>
<p>&emsp;&emsp;这段叙述是在解释setTimeout中执行一个函数时如果这个函数内含有this，那么这个this会指向window对象。也就是说，setTimeout函数会脱离当前函数的运行环境，转而在全局环境上执行传递给它的函数。</p>
<p>&emsp;&emsp;在这个例子中，timer函数在获得wait函数作用域的引用后被setTimeout在全局环境中调用。所以内部函数timer在wait函数执行1000ms后仍保持着对wait作用域的引用，也就是造成了一个闭包。</p>
<h4 id="循环中的闭包"><a href="#循环中的闭包" class="headerlink" title="循环中的闭包"></a>循环中的闭包</h4><p>&emsp;&emsp;考虑一个很常见的说明闭包的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++ ) &#123;</span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(i);        </span><br><span class="line">    &#125;, i*<span class="number">1000</span>);</span><br><span class="line">&#125;			<span class="comment">// 6 *6</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;我们可以看出这个循环的本意是在每次循环的时候都在控制台输出运行时的 i 值，然而输出的却是6个6。思考上面对setTimeout的解释，这个结果又是显而易见的 —— setTimeout使得timer函数的执行环境和for循环的执行环境脱离开来，尽管每次迭代都使用了setTimeout，但它们引用的是同一个变量 i 。因此timer函数输出了6个同样的 i 值。</p>
<p>&emsp;&emsp;我们稍微改写一下上面的例子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++ )&#123;</span><br><span class="line">    setTimeout(timer(i),<span class="number">1000</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">timer</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">inner</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(i);</span><br><span class="line">	&#125; </span><br><span class="line">	<span class="keyword">return</span> inner;</span><br><span class="line">&#125;		<span class="comment">// 012345</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;timer函数在每次迭代时被调用，也同时创建了一个作用域，inner函数在这个作用域中被声明且返回，因此inner具有访问 i 的能力。inner中引用了 i ，相当于保存了当前循环中 i 的值。整个过程的实质是，<strong>每次迭代的时候timer函数都会创建一个不被销毁的作用域，而这个作用域中保存了当前 i 值的副本</strong>。于是当循环结束时，我们创建了6个作用域，每个作用域中都保存了一个 i ，所以这次获得了正确的输出。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++ )&#123;	<span class="comment">// 第一个循环</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(i);</span><br><span class="line">        &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;		<span class="comment">// 6 *6</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这次，利用<strong>立即执行函数会即时创建一个作用域</strong>的特性再次改写上面的代码。显然，匿名的执行函数会在每次迭代的时候创建一个作用域，并在这个作用域中使用setTimeout调用timer函数，于是好像在每次创建作用域的时候都可以得到一个当前 i 值的副本，原理同上。然而实际输出的结果却是6个6。</p>
<p>&emsp;&emsp;具体原因，再次分析这个立即执行函数，可以看到，<strong>setTimeout函数在全局执行，而立即执行函数中除了setTimeout再没有别的变量或者函数，因此这是一个“空的作用域”</strong>，为了能在这个作用域中保存 i 的值，需要再做一些小小的改动。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++ )&#123;	<span class="comment">// 第二个循环</span></span><br><span class="line">    (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> j = i;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> <span class="title">timer</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(j);</span><br><span class="line">        &#125;,<span class="number">1000</span>)</span><br><span class="line">    &#125;)();</span><br><span class="line">&#125;			<span class="comment">// 012345</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;结果正确，改动只是在立即执行函数的作用域中增加了一个变量。</p>
<p>&emsp;&emsp;总结至此，大概已经说完了目前我能了解的部分。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>, <a href="/tags/首刷javascript高级程序设计/">首刷javascript高级程序设计</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-23T01:47:10.000Z"><a href="/2018/05/23/关于javascript模块化开发/">2018-05-23</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/23/关于javascript模块化开发/">关于javascript模块化开发</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;可能在频繁使用复制粘贴解决重复代码之后，才能明白学习模块化开发的重要性。参考了阮一峰前辈的日志以后，稍稍理清了一些思路。随着页面功能复杂化，页面需要编写的js代码也越来越多，页面开发转而使用软件工程的方法进行分工合作、进度管理等等。简单的铺写javascript程序满足不了这些需求，而javascript脚本语言的特性也不满足模块化开发的基本需要 – 没有class 和 module的概念。按照javascript一贯的作风，则是用现有的运行环境下，模拟出模块的概念。</p>
<p>&emsp;&emsp;类比我们批量构建对象时的经验，从工厂模式到构造函数，再到原型模式，再发展为构造函数与原型组合的模式，每次改进都解决了之前模式固有的弊端，也进一步提出了新的问题。模块是实现特定功能的一组方法，模拟模块化模式的过程和构建对象模式的过程也很相似。</p>
<h3 id="原始写法"><a href="#原始写法" class="headerlink" title="原始写法"></a>原始写法</h3><p>&emsp;&emsp;以函数的形式拆解代码，把不同的函数放在一起则构成一个模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module1Func1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// some code...</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">module2Func2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// some code...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在使用这种原始的模块时，调用函数就可以了。但是这种模式下，函数名是在全局声明的，无法保证不与其他变量名、函数名相冲突。此外，模块成员之间看不出联系，如果不再函数名上或注释里说明，几乎是无法区分的。</p>
<h3 id="对象写法"><a href="#对象写法" class="headerlink" title="对象写法"></a>对象写法</h3><p>&emsp;&emsp;为了解决原始写法里成员之间没有联系、全局变量名易导致冲突的问题，将模块中的函数写成对象的属性方法，在使用的时候，调用这个对象的属性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = &#123;</span><br><span class="line">    func1: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// some code...</span></span><br><span class="line">    &#125;,</span><br><span class="line">    func2: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// some code...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">module</span>.func1();</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这种写法将函数联系在一起，但是却没有给予他们恰当的保护，外部可以轻易改写模块对象内部的方法和变量，而为了保证模块的高复用性和可靠性，保护模块内部状态不被篡改是有必要的。</p>
<h3 id="立即执行函数"><a href="#立即执行函数" class="headerlink" title="立即执行函数"></a>立即执行函数</h3><p>&emsp;&emsp;函数有一种显而易见的特性：它的作用域内的变量和方法对外界是不可见的。利用函数的这种特性，可以有效的保护模块内部数据和方法不被篡改以及保证模块本身的可靠性。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="built_in">module</span> = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func1</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// some code...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">func2</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// some code...</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        func1: func1,</span><br><span class="line">        func2: func2</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)();</span><br><span class="line"><span class="built_in">module</span>.func1();			<span class="comment">// 调用</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;到这里，好像已经完美解决了日常使用模块的需要，需要注意的是，由于模块的独立性，模块内部的程序是不直接与外界直接交互的，所以为了使模块能够的调用全局变量，使用模块时应该显式的将所需变量传入模块。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.func1(args1 , args2 ,..);</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-19T11:01:12.000Z"><a href="/2018/05/19/对函数类型的理解/">2018-05-19</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/19/对函数类型的理解/">对函数类型的理解</a></h1>
  

    </header>
    <div class="entry">
      
        <h3 id="函数是对象"><a href="#函数是对象" class="headerlink" title="函数是对象"></a>函数是对象</h3><p>&emsp;&emsp;ECMAscript中的函数实际是function类型的对象实例，因此函数也像对象一样具有属性和方法。而js中的继承，自定义引用类型的实现，均依靠function对象中的prototype属性。</p>
<h3 id="函数名是函数对象的指针"><a href="#函数名是函数对象的指针" class="headerlink" title="函数名是函数对象的指针"></a>函数名是函数对象的指针</h3><p>&emsp;&emsp;类比普通对象的创建过程。</p>
<p>​    <code>var obj = new Object();</code></p>
<p>&emsp;&emsp;变量obj中保存的实际上是新创建的对象在堆内存中的地址，也就是一个指针。而通过函数声明或者构造函数获得的函数对象，其函数名也是这个函数对象的一个指针，因此，如果定义两个相同函数名的函数，后定义的函数名将覆盖前者，这个过程就如变量被重新赋值一样（因此javascript中没有重载）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a - b;</span><br><span class="line">&#125;</span><br><span class="line">sum(<span class="number">100</span>,<span class="number">50</span>);		<span class="comment">//50;</span></span><br></pre></td></tr></table></figure>
<h3 id="函数的声明提升"><a href="#函数的声明提升" class="headerlink" title="函数的声明提升"></a>函数的声明提升</h3><p>&emsp;&emsp;在一般的使用中，函数声明和函数表达式将获得同样的结果。而如果一个函数调用发生在函数声明之后，也不会产生错误。</p>
<blockquote>
<p>&emsp;&emsp;而实际上，解析器在向执行环境中加载数据时，对函数声明和函数表达式并非一视同仁。解析器会率先读取函数声明，并使其在执行任何代码之前可用；至于函数表达式，则必须等到解析器执行到它所在的代码行，才会真正被解释执行。</p>
</blockquote>
<p>&emsp;&emsp;在C语言中，调用未声明的函数是不可行的。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">max(<span class="number">2</span>,<span class="number">3</span>)			<span class="comment">//错误，函数未定义</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">max</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a&gt;b?a:b;</span><br><span class="line">&#125;</span><br><span class="line">max(<span class="number">2</span>,<span class="number">3</span>)			<span class="comment">//3</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;而javascript声明提升的特性使得我们可以在任意地方调用函数，只要它在某一处被声明过。</p>
<h3 id="作为值的函数"><a href="#作为值的函数" class="headerlink" title="作为值的函数"></a>作为值的函数</h3><p>&emsp;&emsp;函数名本身是变量，因此</p>
<ul>
<li>可以把一个函数当作参数传递给另一个函数。</li>
<li>可以在一个函数中返回另一个函数。</li>
</ul>
<p>&emsp;&emsp;在函数作为参数传递的过程中，首先要明确的一点是<strong>要访问函数的指针而不是执行它的话，应该去掉函数名后的括号</strong>。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sum</span> (<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">add</span> (<span class="params">otherFunction , item1 , item2</span>)</span>&#123; 	<span class="comment">//函数作为参数传递</span></span><br><span class="line">    <span class="keyword">return</span> otherFunction(item1,item2);			<span class="comment">//实际上这个函数纯属多余。只是想说明一下函数能作为参数传递。。</span></span><br><span class="line">&#125;</span><br><span class="line">add(sum,<span class="number">3</span>,<span class="number">4</span>);		<span class="comment">// 7</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;在一个函数中返回另一个函数，能想到最接地气的例子是数组的sort排序方法。在sort方法中，需要我们指定一个排序的依据（比较函数）。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">0</span>,<span class="number">3</span>,<span class="number">2</span>,<span class="number">6</span>];</span><br><span class="line">arr.sort(<span class="function"><span class="keyword">function</span>(<span class="params">a,b</span>)</span>&#123;<span class="keyword">return</span> a - b&#125;); <span class="comment">// [0, 1, 2, 3, 4, 5, 6]</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;考虑如果需要以某类对象的某属性值为依据排序的情况。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [&#123;<span class="attr">name</span> :<span class="string">'o'</span>,<span class="attr">score</span> :<span class="number">18</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'c'</span>,<span class="attr">score</span> :<span class="number">12</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'x'</span>,<span class="attr">score</span> :<span class="number">11</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'l'</span>,<span class="attr">score</span> :<span class="number">19</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'a'</span>,<span class="attr">score</span> :<span class="number">22</span>&#125;,];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compare</span>(<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a.score - b.score;</span><br><span class="line">&#125;</span><br><span class="line">arr.sort(compare);      <span class="comment">// compare函数作为参数，回调而非调用</span></span><br><span class="line"><span class="comment">//    0:&#123;name: "x", score: 11&#125;</span></span><br><span class="line"><span class="comment">//    1:&#123;name: "c", score: 12&#125;</span></span><br><span class="line"><span class="comment">//    2:&#123;name: "o", score: 18&#125;</span></span><br><span class="line"><span class="comment">//    3:&#123;name: "l", score: 19&#125;</span></span><br><span class="line"><span class="comment">//    4:&#123;name: "a", score: 22&#125;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;如果事先指定了比较的属性，那么上面的函数完全可以实现需求。而如果在追求复用性的情况下，要求传递一个属性即可按此属性值给对象数组排序。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [&#123;<span class="attr">name</span> :<span class="string">'o'</span>,<span class="attr">score</span> :<span class="number">18</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'c'</span>,<span class="attr">score</span> :<span class="number">12</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'x'</span>,<span class="attr">score</span> :<span class="number">11</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'l'</span>,<span class="attr">score</span> :<span class="number">19</span>&#125;,&#123;<span class="attr">name</span> :<span class="string">'a'</span>,<span class="attr">score</span> :<span class="number">22</span>&#125;,];</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">compare</span>(<span class="params">property</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span>(<span class="params">obj1,obj2</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> obj1[property] - obj2[property];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">arr.sort(compare(<span class="string">'score'</span>));   <span class="comment">//调用而非回调。compare函数返回的匿名函数作为sort方法的回调函数。</span></span><br><span class="line"><span class="comment">//    0:&#123;name: "x", score: 11&#125;</span></span><br><span class="line"><span class="comment">//    1:&#123;name: "c", score: 12&#125;</span></span><br><span class="line"><span class="comment">//    2:&#123;name: "o", score: 18&#125;</span></span><br><span class="line"><span class="comment">//    3:&#123;name: "l", score: 19&#125;</span></span><br><span class="line"><span class="comment">//    4:&#123;name: "a", score: 22&#125;</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这个例子中，比较函数需要取到数组中保存的对象的一个属性并返回比较结果，外层的compare函数接收比较的属性名，return一个以两个对象为参数的匿名函数，最终在匿名函数中取得需要比较的对象的属性，并返回比较结果。</p>
<p>&emsp;&emsp;在这插嘴记叙一下js操作对象属性时圆点操作符和用中括号操作符的不同之处。</p>
<ul>
<li><p>中括号运算符可以用字符串变量的内容作为属性名。 </p>
</li>
<li><p>中括号运算符可以用纯数字为属性名。 </p>
</li>
<li><p>中括号运算符可以用js的关键字和保留字作为属性名。 </p>
</li>
</ul>
<p>&emsp;&emsp;也就是说。<strong>中括号运算符总是能代替点运算符。但点运算符却不一定能全部代替中括号运算符。 </strong>因为例子中属性名是以字符串的形式传递，因此用圆点则会出现函数中取不到对象属性的情况。</p>
<p>我饿了。明天更新。</p>
<p>===============我是一条分割线================</p>
<p>emmm今天520，虐狗的节日那么多。。。嗝~~</p>
<p>==================废话少说==================</p>
<h3 id="函数内部的对象"><a href="#函数内部的对象" class="headerlink" title="函数内部的对象"></a>函数内部的对象</h3><p>&emsp;&emsp;函数本身是一个对象，其内部有两个特殊的对象 – arguments以及this。</p>
<h4 id="arguments"><a href="#arguments" class="headerlink" title="arguments"></a>arguments</h4><p>&emsp;&emsp;arguments中保存着传入函数的所有参数，而js函数不限制传入参数的多少、不介意传入参数类型特性的实现，应该也归功于arguments对象。由于可以通过类此访问数组元素的方法访问arguments对象的成员，因此也称其为<strong>伪数组对象</strong>。arguments对象 也有length属性，其值也类似数组的length属性，表明了函数中参数的个数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">print</span> (<span class="params">a,b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; <span class="built_in">arguments</span>.length; i++)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="built_in">arguments</span>[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">print(<span class="number">1</span>,<span class="number">2</span>,<span class="string">'3'</span>,[<span class="number">4</span>]);</span><br><span class="line"><span class="comment">// 1</span></span><br><span class="line"><span class="comment">// 2</span></span><br><span class="line"><span class="comment">// 3 (字符串)</span></span><br><span class="line"><span class="comment">// [4] (数组)</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;这个例子应该很能说明问题了。。形参只有两个（a和b），但是调用的时候传进去4个类型不一的参数，所以arguments.length = 4，循环打印了4个不同类型的输出。</p>
<h4 id="this"><a href="#this" class="headerlink" title="this"></a>this</h4><p>&emsp;&emsp;this使用时非常灵活。个人觉的是js里第二有趣的部分，第一有趣的部分？大概是原型吧。。</p>
<p>&emsp;&emsp;<strong>this引用的是函数执行时的环境对象</strong>，所以在函数未发生调用时，this的指向是不可确定的。this的指向和程序的执行过程密不可分，也不能脱离具体的执行环境分析this的指向。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">sayId</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id);</span><br><span class="line">&#125;</span><br><span class="line">id = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">var</span> obj = &#123;</span><br><span class="line">    id: <span class="number">2</span>,</span><br><span class="line">    objson: &#123;</span><br><span class="line">   		id: <span class="number">3</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.sayId = sayId;	<span class="comment">// 为obj对象添加sayId方法。</span></span><br><span class="line">obj.objson.sayId = sayId;	<span class="comment">// 为obj对象中的objson对象添加sayId方法。</span></span><br><span class="line"><span class="built_in">window</span>.sayId();		<span class="comment">// 1;</span></span><br><span class="line">obj.sayId();		<span class="comment">// 2；</span></span><br><span class="line">obj.objson.sayId();	 <span class="comment">// 3；</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;sayId引用了this，当window对象调用sayId时（window可省略不写），this指向window，而当obj对象调用sayId时，this指向obj。因此<strong>this总指向调用它的对象</strong>。</p>
<p>&emsp;&emsp;进一步的，当obj.objson.sayId()调用sayId时，this并未指向obj，而是指向了obj对象中的objson对象，因此可得出结论，<strong>this总指向最后调用它的对象</strong>。所以在分析this指向问题时，不妨从调用处开始分析，在不同的函数调用处分析当前this的指向，抽丝剥茧。</p>
<h3 id="函数的属性和方法"><a href="#函数的属性和方法" class="headerlink" title="函数的属性和方法"></a>函数的属性和方法</h3><p>&emsp;&emsp;函数是对象。函数是对象。函数是对象。。。。。</p>
<p>&emsp;&emsp;对象会有属性和方法，所以函数也有属性 – prototype、length，方法 – call、apply。当然不止这些，以后在说。</p>
<h4 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h4><h5 id="length"><a href="#length" class="headerlink" title="length"></a>length</h5><p>&emsp;&emsp;一句话说明：函数的length属性 = 形参的个数，所以函数的length说明了函数期望得到的参数个数。</p>
<h5 id="prototype"><a href="#prototype" class="headerlink" title="prototype"></a>prototype</h5><p>&emsp;&emsp;prototype，原型。js是面向对象的语言，可它没有函数签名所以重载靠检测参数类型模拟；没有类的概念（es2015好像是有class了）所以靠构造函数模拟；没有继承的概念所以靠原型链模拟。。总之为了保证简单，去掉了复杂的概念，然后用简单的东西再去模拟复杂的东西。prototype则主要用在继承的实现上。</p>
<p>&emsp;&emsp;在用构造函数构造对象时，有一个显而易见的缺点 – 无法共享属性和方法。构造出的对象每个都是相互独立的，既不互相影响，也都有自己属性和方法的副本，没有共享可言，也浪费了资源。为了解决这个问题，每个函数都有一个prototype属性，这里记录了    所有实例对象需要共享的属性和方法，而那些不需要共享的数据或者方法，则还放在构造函数中去。而实例对象一经创建，自动引用prototype中记录的属性和方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Dog</span> (<span class="params">name, age</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">&#125;</span><br><span class="line">Dog.prototype.class = <span class="string">'犬科'</span>;</span><br><span class="line">Dog.prototype.sayProperty = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'单身狗'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> xcola = <span class="keyword">new</span> Dog(xcola, <span class="number">23</span>);</span><br><span class="line"><span class="keyword">var</span> cola = <span class="keyword">new</span> Dog(cola, <span class="number">23</span>);</span><br><span class="line">xcola.sayProperty();		<span class="comment">// 单身狗</span></span><br><span class="line">cola.class;			<span class="comment">// 犬科</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;prototype记录的方法和属性为所有实例所共享，而prototype一经改动，变化也会反映在所有实例中。所以看起来，prototype像是实例对象的原型，实例则像是继承了prototype对象。</p>
<h4 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h4><p>&emsp;&emsp;函数有两个相似的方法 – call和apply。不仅作用相似，使用方法也很相似。接下来是一段引用，看完是有点茅塞顿开的感觉。。</p>
<blockquote>
<p>每个函数都包涵两个非继承而来的方法：apply()和call()。这两个方法的用途都是在特定的作用域中调用函数。实际上等于设置函数体内的this对象的值。</p>
</blockquote>
<p>&emsp;&emsp;如果死记硬背call和apply的作用是改变函数中this的值，可能不能领会到在程序中使用call和apply函数的真正意图。</p>
<p>&emsp;&emsp;call()的第一个参数是this指针的指向，其余参数则为要传给函数的参数。如下代码将func函数内部的this指针指向了window对象，a和b则是传给func函数的参数。而apply()与call()的区别仅仅是在于，传给函数的是参数还是参数数组。然而如果func函数需要的参数是arguments，此时显然apply函数更为恰当。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">func.call(<span class="built_in">window</span>,a,b)</span><br><span class="line">func.apply(<span class="built_in">window</span>,[a,b])</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;引自javascript高级程序设计，call和apply真正强大的地方在于扩展函数赖以运行的作用域。通过这两种方法，可以使得对象获得指定对象的属性和方法。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Person</span>(<span class="params">name , age</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = name;</span><br><span class="line">    <span class="keyword">this</span>.age = age;</span><br><span class="line">    <span class="keyword">this</span>.sayHello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    	<span class="built_in">console</span>.log(<span class="string">'hi danshengou'</span>)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Student</span>(<span class="params">name ,age ,score</span>)</span>&#123;</span><br><span class="line">    Person.call(<span class="keyword">this</span>, name, age);</span><br><span class="line">    <span class="keyword">this</span>.score = score;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> s = <span class="keyword">new</span> Student(<span class="string">'cola'</span>, <span class="number">23</span>, <span class="number">60</span>);</span><br><span class="line">s.sayHello();		<span class="comment">// hi danshengou</span></span><br><span class="line">s.name;				<span class="comment">// cola</span></span><br><span class="line">s.age;				<span class="comment">// 23</span></span><br><span class="line">s.score;			<span class="comment">// 60</span></span><br></pre></td></tr></table></figure>
<p>从网上借鉴来一种运用场景：通过<code>document.getElementsByTagName</code></p>
<p>选择的dom节点是一种类似array的伪数组。但它不能应用Array下的push，pop等方法。于是可以通过：<br><code>var domNodes =  Array.prototype.slice.call(document.getElementsByTagName(&quot;*&quot;));</code><br>这样domNodes就可以应用Array下的所有方法了。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>, <a href="/tags/首刷javascript高级程序设计/">首刷javascript高级程序设计</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-18T06:33:28.000Z"><a href="/2018/05/18/sass语法小记/">2018-05-18</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/18/sass语法小记/">sass语法小记</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp; &emsp; 在接触sass后，回想之前初学时写过的css文件，确实简陋粗糙。如果能用sass重写估计会节省很多时间，以及维护修改时的工作量。sass的关键字以@开头，变量则以$开头，基础语法还是挺简单的，只是目前缺乏实践，尚不能自如运用。</p>
<p>#####记录所学的基础语法~</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line">@charset &quot;UTF-8&quot;;</span><br><span class="line">@import &quot;commen&quot;;//  导入</span><br><span class="line">$fontsize : &quot;16px&quot;;//变量</span><br><span class="line">ul&#123;</span><br><span class="line">  font-size: $fontsize;</span><br><span class="line">&#125;</span><br><span class="line">//嵌套</span><br><span class="line">.banner&#123;</span><br><span class="line">  width:100%;</span><br><span class="line">  .box&#123;</span><br><span class="line">    height:100px;</span><br><span class="line">    .img&#123;</span><br><span class="line">      float: left;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//继承</span><br><span class="line">ul&#123;</span><br><span class="line">  width:100px;</span><br><span class="line">  height:100px;</span><br><span class="line">  color: #ccc;</span><br><span class="line">  font-size: $fontsize;</span><br><span class="line">&#125;</span><br><span class="line">div&#123;</span><br><span class="line">  @extend ul;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//混入</span><br><span class="line">@mixin setProp($a,$b,$c)&#123;</span><br><span class="line">  width:$a;</span><br><span class="line">  height:$b;</span><br><span class="line">  color: $c;</span><br><span class="line">&#125;</span><br><span class="line">div&#123;</span><br><span class="line">  @include setProp(100px,100px,#ccc);</span><br><span class="line">&#125;</span><br><span class="line">//函数</span><br><span class="line">@function dar($a)&#123;</span><br><span class="line">  @return $a*10px;</span><br><span class="line">&#125;</span><br><span class="line">div&#123;</span><br><span class="line">  width:dar(10);</span><br><span class="line">&#125;</span><br><span class="line">//循环</span><br><span class="line">@for $i from 1 through 10&#123;</span><br><span class="line">  div:nth-of-type(#&#123;$i&#125;)&#123;</span><br><span class="line">    width: $i;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">//判断</span><br><span class="line">@if true &#123;</span><br><span class="line">  div&#123;</span><br><span class="line">    width: 10px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;@else&#123;</span><br><span class="line">  div&#123;</span><br><span class="line">    height:100px;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>





  <article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-18T02:20:29.000Z"><a href="/2018/05/18/cent-os-搭建shadowsocks服务/">2018-05-18</a></time>
      
      
  
    <h1 class="title"><a href="/2018/05/18/cent-os-搭建shadowsocks服务/">cent os 搭建shadowsocks服务</a></h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;一直设想买一个国外的vps架个ss，碰巧这两天内网病毒泛滥网络几乎瘫痪，拿手里的腾讯云学生机搭个ss当个跳板。       </p>
<h2 id="安装ss"><a href="#安装ss" class="headerlink" title="安装ss"></a>安装ss</h2><p>​    <code>wget --no-check-certificate https://down.upx8.com/shell/shadowsocks-go.sh</code></p>
<p>​    <code>chmod +x shadowsocks-go.sh</code></p>
<p>​    <code>./shadowsocks-go.sh 2&gt;&amp;1 | tee shadowsocks-go.log</code></p>
<h2 id="卸载方法"><a href="#卸载方法" class="headerlink" title="卸载方法"></a>卸载方法</h2><p>​    <code>./shadowsocks-go.sh uninstall</code></p>
<p>​    </p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/服务器/">服务器</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/瞎折腾/">瞎折腾</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>






<nav id="pagination">
  
  <nav id="page-nav">
    <a class="extend prev" rel="prev" href="/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/">Next &raquo;</a>
  </nav>

</nav>
</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/前端/">前端</a><small>17</small></li>
  
    <li><a href="/categories/博客/">博客</a><small>1</small></li>
  
    <li><a href="/categories/服务器/">服务器</a><small>2</small></li>
  
    <li><a href="/categories/随笔/">随笔</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2018/12/22/一点感想/">一点感想</a>
      </li>
    
      <li>
        <a href="/2018/12/18/前端导出数据到excel文件/">前端导出数据到excel文件</a>
      </li>
    
      <li>
        <a href="/2018/12/18/LeeTCode两数相加/">LeeTCode两数相加</a>
      </li>
    
      <li>
        <a href="/2018/11/17/2018-11-杂记/">2018-11-杂记</a>
      </li>
    
      <li>
        <a href="/2018/10/27/2018-10-第四周读书笔记/">2018/10第四周杂记</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/JavaScript设计模式与开发实践/">JavaScript设计模式与开发实践</a><small>2</small></li>
  
    <li><a href="/tags/NodeJS/">NodeJS</a><small>1</small></li>
  
    <li><a href="/tags/React/">React</a><small>1</small></li>
  
    <li><a href="/tags/Vue/">Vue</a><small>1</small></li>
  
    <li><a href="/tags/jQuery/">jQuery</a><small>1</small></li>
  
    <li><a href="/tags/代码整洁之道/">代码整洁之道</a><small>1</small></li>
  
    <li><a href="/tags/学习笔记/">学习笔记</a><small>15</small></li>
  
    <li><a href="/tags/瞎折腾/">瞎折腾</a><small>3</small></li>
  
    <li><a href="/tags/随笔/">随笔</a><small>1</small></li>
  
    <li><a href="/tags/面试笔记/">面试笔记</a><small>2</small></li>
  
    <li><a href="/tags/首刷javascript高级程序设计/">首刷javascript高级程序设计</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/JavaScript设计模式与开发实践/" style="font-size: 13.33px;">JavaScript设计模式与开发实践</a> <a href="/tags/NodeJS/" style="font-size: 10px;">NodeJS</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/代码整洁之道/" style="font-size: 10px;">代码整洁之道</a> <a href="/tags/学习笔记/" style="font-size: 20px;">学习笔记</a> <a href="/tags/瞎折腾/" style="font-size: 16.67px;">瞎折腾</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a> <a href="/tags/面试笔记/" style="font-size: 13.33px;">面试笔记</a> <a href="/tags/首刷javascript高级程序设计/" style="font-size: 13.33px;">首刷javascript高级程序设计</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2018 xcola
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="bg"></div>
</body>
</html>