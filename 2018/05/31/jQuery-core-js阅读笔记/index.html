<!DOCTYPE HTML>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>jQuery-core.js（整体架构部分）阅读笔记 | xco1a&#39;s b10g</title>
  <meta name="author" content="xcola">

  
  <meta name="description" content="做有态度的码农">
  

  

  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="jQuery-core.js（整体架构部分）阅读笔记">
  <meta property="og:site_name" content="xco1a&#39;s b10g">

  
  

  
    <meta property="og:image" content="">
  

  
  <link href="/css/images/favicon.ico" rel="icon">
  

  <link rel="alternate" href="/atom.xml" title="xco1a&#39;s b10g" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  


  <!-- baidu webmaster push -->
  <script src="//push.zhanzhang.baidu.com/push.js"></script>

</head>
</html>

<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">xco1a&#39;s b10g</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div></header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2018-05-31T13:32:29.000Z"><a href="/2018/05/31/jQuery-core-js阅读笔记/">2018-05-31</a></time>
      
      
  
    <h1 class="title">jQuery-core.js（整体架构部分）阅读笔记</h1>
  

    </header>
    <div class="entry">
      
        <p>&emsp;&emsp;突然有了看看jQuery源码的念头。毕竟同样是js，为什么jQuery可以实现那么多方便易用的特性，同时也希望在拜读源码的过程中，能学习到一些关于构建库和模块的思路。</p>
<p>&emsp;&emsp;源码下载自github，目前为最新版3.3.1，先从总体架构看起 —— core,js。摘取部分并整理一下。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jQuery = <span class="built_in">window</span>.jQuery = <span class="built_in">window</span>.$ = <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;		</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> jQuery.fn.init( selector, context );			</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">var</span> quickExpr = <span class="regexp">/^[^&lt;]*(&lt;(.|\s)+&gt;)[^&gt;]*$|^#(\w+)$/</span>,	</span><br><span class="line">	isSimple = <span class="regexp">/^.[^:#\[\.]*$/</span>,</span><br><span class="line">	<span class="literal">undefined</span>;	</span><br><span class="line">jQuery.fn = jQuery.prototype = &#123;			</span><br><span class="line">	init: <span class="function"><span class="keyword">function</span>(<span class="params"> selector, context </span>) </span>&#123;&#125;,</span><br><span class="line">    </span><br><span class="line">    	size: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 返回jq对象中个元素个数</span></span><br><span class="line">    	get: <span class="function"><span class="keyword">function</span>(<span class="params"> num </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 以类似数组索引的方法取得一个jq对象中的元素</span></span><br><span class="line">    	pushStack: <span class="function"><span class="keyword">function</span>(<span class="params"> elems </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 将一个元素压入jq栈</span></span><br><span class="line">    	each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 迭代器，可遍历数组和对象</span></span><br><span class="line">    	index: <span class="function"><span class="keyword">function</span>(<span class="params"> elem </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 搜寻指定元素，返回其位置</span></span><br><span class="line">    	attr: <span class="function"><span class="keyword">function</span>(<span class="params"> name, value, type </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 获取匹配元素集合中第一个元素的属性值，或为每个匹配元素设置一个或多个属性</span></span><br><span class="line">    	css: <span class="function"><span class="keyword">function</span>(<span class="params"> key, value </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 获取匹配元素中第一个元素的样式或者给指定的元素设定CSS样式</span></span><br><span class="line">    	wrapAll: <span class="function"><span class="keyword">function</span>(<span class="params"> html </span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 在对象外部插入html标签</span></span><br><span class="line">		append: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">    <span class="comment">// 将由参数指定的内容插入匹配元素集合中每个元素的末尾</span></span><br><span class="line">    	find: <span class="function"><span class="keyword">function</span>(<span class="params"> selector </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 获取当前匹配元素中符合参数选择器的对象</span></span><br><span class="line">	clone: <span class="function"><span class="keyword">function</span>(<span class="params"> events </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 深拷贝一组匹配元素的值</span></span><br><span class="line">	add: <span class="function"><span class="keyword">function</span>(<span class="params"> selector </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 以给定的参数创建一个新的jq对象</span></span><br><span class="line">	is: <span class="function"><span class="keyword">function</span>(<span class="params"> selector </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 根据给定的条件检查当前匹配元素，存在匹配时返回true</span></span><br><span class="line">	val: <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 返回当前元素的value值</span></span><br><span class="line">	html: <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 返回或设定当前元素的html标签内容</span></span><br><span class="line">	replaceWith: <span class="function"><span class="keyword">function</span>(<span class="params"> value </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 用提供的内容替换当前匹配元素</span></span><br><span class="line">	eq: <span class="function"><span class="keyword">function</span>(<span class="params"> i </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 以索引的方式取得一组jq对象中的某一个对象</span></span><br><span class="line">	slice: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 和数组的slice方法类似，可以缩小当前jq对象数组的范围</span></span><br><span class="line">	map: <span class="function"><span class="keyword">function</span>(<span class="params"> callback </span>) </span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 和数组的map方法类似</span></span><br><span class="line">	data: <span class="function"><span class="keyword">function</span>(<span class="params"> key, value </span>)</span>&#123;&#125;,</span><br><span class="line">	<span class="comment">// 向dom元素附加一个数据（键值对）</span></span><br><span class="line">	domManip: <span class="function"><span class="keyword">function</span>(<span class="params"> args, table, reverse, callback </span>) </span>&#123;&#125;</span><br><span class="line">&#125;;</span><br><span class="line">	<span class="comment">// dom操作的核心函数</span></span><br><span class="line">jQuery.fn.init.prototype = jQuery.fn;</span><br><span class="line">	<span class="comment">// 把jQuery的原型传递给init的原型</span></span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;首先在全局注册jQuery变量（$），随后此变量指向jq的构造函数。有个很有意思的小地方 ——  定义了一个变量叫 undefined，由于没给它赋值，因此它的值也是undefined。这样做的意义可以分为两个方面，首先它减少了程序在作用域链中搜寻undefined值的时间，其次也在防范用户有意无意的改变undefined的值（undefined是可以赋值的，但谷歌浏览器会忽视用户给undefined的赋值）。</p>
<p>&emsp;&emsp;值得学习的是，在构造函数中 “return new ” 的方法使得jq获得了无new构造jq对象的特性，但是，如果直接return 自己的构造函数无疑会造成无限递归自己的问题。如下所示。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> jQuery = <span class="function"><span class="keyword">function</span>(<span class="params">selector</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.selector = selector;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> jQuery(selector);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;因此这个构造函数把构造对象的任务交给了jQuery.fn.init函数。jQuery.fn.init实际上是jQuery.prototype.init，在这个过程中，分离出两个不同的构造器 —— jQuery.prototype和jQuery.prototype.init.prototype。到了这里虽然解决了无new操作且避免递归的问题，也自然而然引出另一个问题 —— 构建jq对象的任务是在jQuery.prototype.init.prototype中完成的，所以构建出的对象其原型会指向jQuery.prototype.init.prototype而不是jQuery.prototype，其this也无法引用到jQuery的原型方法。</p>
<p>&emsp;&emsp;比如，在jQuery.prototype中，还有很多种方法，在上面的代码块中仅列出一部分函数的声明，注释中给出了每个方法的作用。这些方法均为实例方法，实例化出的jq对象即可调用。</p>
<p>&emsp;&emsp;另外，jQuery本身还存在很多静态方法，这些方法由jQuery直接调用，例如扩展方法（extend）。可以发现，在这其中存在静态和实例方法中有共用的方法，即既是静态方法，也是实例方法，举个栗子。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">each: <span class="function"><span class="keyword">function</span>(<span class="params"> callback, args </span>) </span>&#123;</span><br><span class="line">		<span class="keyword">return</span> jQuery.each( <span class="keyword">this</span>, callback, args );</span><br><span class="line">	&#125;,</span><br></pre></td></tr></table></figure>
<p>&emsp;&emsp;each方法可以被实例化的对象调用也可以被jQuery本身调用。且这个静态方法的实现还依赖于实例方法。但jq实例是通过init构造器构造的，init构造器和jQuery构造器又是分离的，那么怎么解决这个问题呢，在这段程序的最后。</p>
<p><code>jQuery.fn.init.prototype = jQuery.fn;</code></p>
<p>&emsp;&emsp;把jQuery的原型传递给init的原型，这样jQuery.prototype.init.prototype会指向jQuery.prototype，事实上也就是jQuery的原型对象覆盖了init构造器的原型对象。通过这种方法，将两个分离的构造器整合在了一起。当用户使用$()时，首先通过init构造器创建了一个jq对象，其次通过jQuery.fn.init.prototype = jQuery.fn的方法将实例方法挂载，静态方法又依赖于实例方法才得以实现，至此，通过init构造器完成了无new化jq对象的构建、通过init和jQuery的原型传递实现了实例方法挂载、在实例方法中call或者apply方法又实现了jQuery静态方法的挂载。</p>
<p>&emsp;&emsp;这一部分原理和思路是我在参考了很多前辈和大神的分析讲解后才得以勉强理解。在构建对象的核心模块上尽显其思路之巧妙写法之风骚。此外，core.js中在实例方法和静态方法的处理中展现出的编程技巧也十分值得学习。阅读源码过程艰难，基本就处于理解偏差乃至根本看不懂的尴尬境地，但希望拜读之后，这些思路和技巧亦能成为我的血肉。</p>

      
    </div>
    
    <footer>
        <div class="alignright">
          
          <a href="javascript:void(0)" class="share-link bdsharebuttonbox" data-cmd="more">分享</a>
        </div>
        
  
  <div class="categories">
    <a href="/categories/前端/">前端</a>
  </div>

        
  
  <div class="tags">
    <a href="/tags/学习笔记/">学习笔记</a>, <a href="/tags/jQuery/">jQuery</a>
  </div>

        <!-- partial('post/share') -->
      <div class="clearfix"></div>
    </footer>
  </div>
</article>



</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Search">
    <input type="hidden" name="q" value="site:yoursite.com">
  </form>
</div>

  
<div class="widget tag">
  <h3 class="title">Categories</h3>
  <ul class="entry">
  
    <li><a href="/categories/前端/">前端</a><small>17</small></li>
  
    <li><a href="/categories/博客/">博客</a><small>1</small></li>
  
    <li><a href="/categories/服务器/">服务器</a><small>2</small></li>
  
    <li><a href="/categories/随笔/">随笔</a><small>1</small></li>
  
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Recent Posts</h3>
  <ul class="entry">
    
      <li>
        <a href="/2018/12/22/一点感想/">一点感想</a>
      </li>
    
      <li>
        <a href="/2018/12/18/前端导出数据到excel文件/">前端导出数据到excel文件</a>
      </li>
    
      <li>
        <a href="/2018/12/18/LeeTCode两数相加/">LeeTCode两数相加</a>
      </li>
    
      <li>
        <a href="/2018/11/17/2018-11-杂记/">2018-11-杂记</a>
      </li>
    
      <li>
        <a href="/2018/10/27/2018-10-第四周读书笔记/">2018/10第四周杂记</a>
      </li>
    
  </ul>
</div>


  
<div class="widget tag">
  <h3 class="title">Tags</h3>
  <ul class="entry">
  
    <li><a href="/tags/JavaScript设计模式与开发实践/">JavaScript设计模式与开发实践</a><small>2</small></li>
  
    <li><a href="/tags/NodeJS/">NodeJS</a><small>1</small></li>
  
    <li><a href="/tags/React/">React</a><small>1</small></li>
  
    <li><a href="/tags/Vue/">Vue</a><small>1</small></li>
  
    <li><a href="/tags/jQuery/">jQuery</a><small>1</small></li>
  
    <li><a href="/tags/代码整洁之道/">代码整洁之道</a><small>1</small></li>
  
    <li><a href="/tags/学习笔记/">学习笔记</a><small>15</small></li>
  
    <li><a href="/tags/瞎折腾/">瞎折腾</a><small>3</small></li>
  
    <li><a href="/tags/随笔/">随笔</a><small>1</small></li>
  
    <li><a href="/tags/面试笔记/">面试笔记</a><small>2</small></li>
  
    <li><a href="/tags/首刷javascript高级程序设计/">首刷javascript高级程序设计</a><small>2</small></li>
  
  </ul>
</div>


  
<div class="widget tagcloud">
  <h3 class="title">Tag Cloud</h3>
  <div class="entry">
    <a href="/tags/JavaScript设计模式与开发实践/" style="font-size: 13.33px;">JavaScript设计模式与开发实践</a> <a href="/tags/NodeJS/" style="font-size: 10px;">NodeJS</a> <a href="/tags/React/" style="font-size: 10px;">React</a> <a href="/tags/Vue/" style="font-size: 10px;">Vue</a> <a href="/tags/jQuery/" style="font-size: 10px;">jQuery</a> <a href="/tags/代码整洁之道/" style="font-size: 10px;">代码整洁之道</a> <a href="/tags/学习笔记/" style="font-size: 20px;">学习笔记</a> <a href="/tags/瞎折腾/" style="font-size: 16.67px;">瞎折腾</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a> <a href="/tags/面试笔记/" style="font-size: 13.33px;">面试笔记</a> <a href="/tags/首刷javascript高级程序设计/" style="font-size: 13.33px;">首刷javascript高级程序设计</a>
  </div>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  <p>
  
  &copy; 2018 xcola
  
  All rights reserved.</p>
  <p>Powered by <a href="http://hexo.io/" target="_blank">Hexo</a></p>
</div>
<div class="clearfix"></div>

<script>window._bd_share_config={"common":{"bdSnsKey":{},"bdText":"","bdMini":"1","bdMiniList":false,"bdPic":"","bdStyle":"2","bdSize":"16"},"share":{}};with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?v=89860593.js?cdnversion='+~(-new Date()/36e5)];</script></footer>
  <script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>


<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>


<div id="bg"></div>
</body>
</html>